(this.webpackJsonprpnlatex=this.webpackJsonprpnlatex||[]).push([[0],{29:function(e,t,n){},30:function(e,t,n){},36:function(e,t,n){"use strict";n.r(t);var r=n(6),i=n.n(r),s=n(20),a=n.n(s),o=n(7),c=n(2),u=n(0),l=n(1),p=n(8),_=n(4),h=n(3),f=(n(29),n(30),n(16)),m=n.n(f),d=n(5),x=n(22),v=n(9),y={base:{"[alnum]":"self_insert","!":"autoparenthesize;insert !;concat","#":"insert \\#","@":"insert @","^":"superscript","*":"insert *","~":"insert \\sim",Enter:"subscript",_:"subscript",Backspace:"pop","`":"superscript"," ":"autoparenthesize 2;concat","=":"mode relational","<":"infix <",">":"infix >","+":"infix +","-":"infix -","]":"make_bold","[":"delimiters [ ]","(":"delimiters ( )","{":"delimiters \\{ \\}",ArrowUp:"change_document_selection -1","Shift+ArrowUp":"shift_document_selection -1",ArrowDown:"change_document_selection +1","Shift+ArrowDown":"shift_document_selection +1",PageUp:"change_document_selection -5",PageDown:"change_document_selection +5",Home:"change_document_selection -10000",End:"change_document_selection +10000",ArrowRight:"scroll stack_panel horizontal 75",ArrowLeft:"scroll stack_panel horizontal -75",Tab:"mode stack","'":"mode symbol",".":"mode decoration",",":"mode infix",")":"mode delimiters","}":"custom_delimiter",";":"mode lowercase_greek",":":"mode uppercase_greek","%":"mode calligraphic","&":"mode script","/":"mode operator","\\":"start_text_entry math_text_entry",'"':"start_text_entry text_entry","|":"mode array",$:"mode config","?":"toggle_popup help","Ctrl+0":"insert 0;subscript","Ctrl+1":"insert -1;superscript","Ctrl+2":"insert 2;superscript","Ctrl+3":"insert 3;superscript","Ctrl+4":"insert 4;superscript","Ctrl+a":"swap","Ctrl+b":"make_bold","Ctrl+c":"copy_to_clipboard","Ctrl+e":"insert e;operator mathrm;swap;superscript","Ctrl+i":"pop_to_document","Ctrl+j":"extract_from_document","Ctrl+k":"infix \\,","Ctrl+l":"recenter_document 50","Ctrl+m":"prefix -","Ctrl+o":"parenthesize;swap;operator mathopen;swap;concat","Ctrl+p":"delimiters ( )","Ctrl+s":"save_file","Ctrl+u":"superscript","Ctrl+v":"paste_from_clipboard","Ctrl+y":"redo","Ctrl+z":"undo","Ctrl+ ":"infix \\,","Ctrl+,":"infix ,","Ctrl+ArrowRight":"scroll document_container horizontal 75","Ctrl+ArrowLeft":"scroll document_container horizontal -75","Ctrl+/":"operator frac 2"},files:{default:"toggle_popup files",d:"delete_selected_file",n:"start_new_file",Enter:"load_selected_file",s:"save_file",S:"save_file_as",ArrowUp:"select_adjacent_file -1",ArrowDown:"select_adjacent_file 1"},help:{ArrowUp:"scroll popup_panel vertical -25",ArrowDown:"scroll popup_panel vertical 25",ArrowLeft:"do_cancel",ArrowRight:"do_cancel",PageUp:"scroll popup_panel vertical -95",PageDown:"scroll popup_panel vertical 95",default:"toggle_popup help"},stack:{"[digit]":"prefix_argument","*":"prefix_argument",a:"swap",c:"copy_to_clipboard",d:"pop",i:"pop_to_document",I:"pop_to_document preserve",f:"toggle_popup files",j:"extract_from_document",J:"extract_from_document preserve",l:"recenter_document 50",n:"nip",o:"over",r:"rot",s:"save_file",t:"tuck",u:"unrot",v:"paste_from_clipboard",Enter:"dup",Backspace:"pop",Tab:"undo",".":"redo","!":"export_document_as_text","@":"export_stack_items_as_text",$:"toggle_show_latex_source",ArrowRight:"scroll document_container horizontal 75",ArrowLeft:"scroll document_container horizontal -75","?":"toggle_popup help stack"},config:{i:"config toggle_inline_math",m:"mode config_math_alignment",r:"config reset_layout",s:"mode config_stack",t:"mode config_theme",z:"mode config_zoom",$:"insert \\$","?":"toggle_popup help configuration"},config_math_alignment:{d:"config math_align toggle_document",s:"config math_align toggle_stack","?":"toggle_popup help configuration"},config_stack:{0:"config stack_split 0",1:"config stack_split 10",2:"config stack_split 20",3:"config stack_split 30",4:"config stack_split 40",5:"config stack_split 50",6:"config stack_split 60",7:"config stack_split 70",8:"config stack_split 80",9:"config stack_split 90","*":"config stack_split 100",ArrowLeft:"config stack_side left",ArrowRight:"config stack_side right",ArrowUp:"config stack_side top",ArrowDown:"config stack_side bottom","?":"toggle_popup help configuration"},config_theme:{0:"config theme default",1:"config theme dawn",2:"config theme dusk",3:"config theme dark","?":"toggle_popup help configuration"},config_zoom:{0:"config zoom_factor 0","+":"config zoom_factor +","-":"config zoom_factor -","?":"toggle_popup help configuration"},text_entry:{Enter:"finish_text_entry text","Shift+Enter":"finish_text_entry heading",Escape:"cancel_text_entry","Ctrl+z":"cancel_text_entry",Backspace:"backspace_text_entry",default:"append_text_entry"},math_text_entry:{Enter:"finish_text_entry math","Shift+Enter":"finish_text_entry roman_math","\\":"start_text_entry latex_entry",Escape:"cancel_text_entry","Ctrl+z":"cancel_text_entry",Backspace:"backspace_text_entry",default:"append_text_entry"},latex_entry:{Enter:"finish_text_entry latex",Escape:"cancel_text_entry","Ctrl+z":"cancel_text_entry",Backspace:"backspace_text_entry math_text_entry",default:"append_text_entry"},delimiters:{b:"delimiters \\langle \\vert",c:"delimiters \\lceil \\rceil",f:"delimiters \\lfloor \\rfloor",g:"delimiters \\lgroup \\rgroup",i:"delimiters \\langle \\rangle \\vert 2",I:"delimiters \\langle \\rangle \\vert 3",k:"delimiters \\vert \\rangle",m:"delimiters \\lmoustache \\rmoustache",n:"delimiters \\lVert \\rVert",N:"delimiters \\lVert \\rVert",w:"delimiters . \\vert",W:"delimiters . \\vert","|":"delimiters \\vert \\vert","<":"delimiters \\langle \\rangle","(":"delimiters ( )","[":"delimiters [ ]","]":"insert \\llbracket;swap;concat;insert \\rrbracket;concat","{":"delimiters \\{ \\}","?":"toggle_popup help delimiters"},custom_delimiters:{"[digit]":"prefix_argument",c:"custom_delimiter \\lceil",C:"custom_delimiter \\rceil",f:"custom_delimiter \\lfloor",F:"custom_delimiter \\rfloor",g:"custom_delimiter \\lgroup",G:"custom_delimiter \\rgroup",m:"custom_delimiter \\lmoustache",M:"custom_delimiter \\rmoustache",v:"custom_delimiter \\Vert","<":"custom_delimiter \\langle",">":"custom_delimiter \\rangle","(":"custom_delimiter (",")":"custom_delimiter )","[":"custom_delimiter [","]":"custom_delimiter ]","{":"custom_delimiter \\{","}":"custom_delimiter \\}",".":"custom_delimiter .","/":"custom_delimiter /","\\":"custom_delimiter \\backslash","|":"custom_delimiter |","?":"toggle_popup help delimiters"},operator:{1:"insert 1;swap;operator frac 2",2:"mode squared",a:"apply_operator 1",A:"apply_operator 2",b:"operator binom 2",c:"named_function cos",C:"named_function csc",d:"mode derivative",D:"named_function det",e:"insert e;operator mathrm;swap;superscript",E:"named_function exp",f:"delimiters . . / 2",g:"insert \\argmin;swap;subscript",G:"insert \\argmax;swap;subscript",h:"mode hyperbolic",i:"mode integral_limits",k:"delimiters . . \\vert 2;parenthesize;swap;operator mathopen;swap;concat",l:"insert \\limits;swap;subscript;insert \\lim;swap;concat",m:"named_function min",M:"named_function max",n:"named_function ln",N:"named_function log",o:"parenthesize;swap;operator mathopen;swap;concat",O:"infix ,;parenthesize;swap;operator mathopen;swap;concat",p:"parenthesize;operator Pr",P:"insert \\,;swap;concat;swap;insert \\,;concat;swap;delimiters . . \\vert 2;parenthesize;operator Pr",q:"operator sqrt",Q:"operator sqrt[3]",s:"named_function sin",S:"named_function sec",t:"named_function tan",T:"named_function cot",u:"insert \\limits;swap;subscript;insert \\inf;swap;concat",U:"insert \\limits;swap;subscript;insert \\sup;swap;concat",v:"parenthesize;insert Var;operator operatorname;swap;concat",V:"swap;insert ,;concat;swap;concat;parenthesize;insert Cov;operator operatorname;swap;concat",x:"insert E;operator mathbb;operator mathopen;swap;delimiters [ ];concat",X:"insert E;operator mathbb;swap;subscript;operator mathopen;swap;delimiters [ ];concat",";":"apply_tag",",":"split_infix","/":"operator frac 2","[":"delimiters [ ];swap;operator mathopen;swap;concat","]":"delimiters \\{ \\};swap;operator mathopen;swap;concat","}":"swap;operator underbrace;swap;subscript","{":"swap;operator overbrace;swap;superscript","<":"extract_infix_side left",">":"extract_infix_side right","-":"mode inverse","=":"unrot;infix =;insert \\sum;swap;subscript;swap;superscript","+":"infix \\ge;insert \\sum;swap;subscript","'":"substitute_defer",'"':"toggle_is_heading",Enter:"unrot;subscript;swap;superscript","?":"toggle_popup help operators"},hyperbolic:{s:"named_function sinh",S:"named_function sech",c:"named_function cosh",C:"named_function csch",t:"named_function tanh",T:"named_function coth"},inverse:{s:"named_function sin -1",S:"named_function sec -1",c:"named_function cos -1",C:"named_function csc -1",t:"named_function tan -1",T:"named_function cot -1",h:"mode inverse_hyperbolic"},inverse_hyperbolic:{s:"named_function sinh -1",S:"named_function sech -1",c:"named_function cosh -1",C:"named_function csch -1",t:"named_function tanh -1",T:"named_function coth -1"},squared:{s:"named_function sin 2",S:"named_function sec 2",c:"named_function cos 2",C:"named_function csc 2",t:"named_function tan 2",T:"named_function cot 2",h:"mode squared_hyperbolic"},squared_hyperbolic:{s:"named_function sinh 2",S:"named_function sech 2",c:"named_function cosh 2",C:"named_function csch 2",t:"named_function tanh 2",T:"named_function coth 2"},integral_limits:{r:"insert -\\infty;subscript;insert \\infty;superscript",n:"insert -\\infty;subscript;insert 0;superscript",p:"insert 0;subscript;insert \\infty;superscript",u:"insert 0;subscript;insert 1;superscript",U:"insert -1;subscript;insert 1;superscript",t:"insert 0;subscript;insert 2\\pi;superscript",T:"insert -\\pi;subscript;insert \\pi;superscript","?":"toggle_popup help integrals"},derivative:{j:"insert \\partial;swap;concat;swap;insert \\partial;swap;concat;swap;operator frac 2",J:"insert 2;superscript;insert \\partial;swap;concat;swap;insert \\partial;insert 2;superscript;swap;concat;swap;operator frac 2",k:"insert d;operator mathrm;swap;concat;swap;insert d;operator mathrm;swap;concat;swap;operator frac 2",K:"insert 2;superscript;insert d;operator mathrm;swap;concat;swap;insert d;operator mathrm;insert 2;superscript;swap;concat;swap;operator frac 2",q:"insert \\partial;swap;concat;insert \\partial;swap;operator frac 2",Q:"insert 2;superscript;insert \\partial;swap;concat;insert \\partial;insert 2;superscript;swap;operator frac 2",x:"insert d;operator mathrm;swap;concat;insert d;operator mathrm;swap;operator frac 2",X:"insert 2;superscript;insert d;operator mathrm;swap;concat;insert d;operator mathrm;insert 2;superscript;swap;operator frac 2",m:"insert \\partial;swap;concat;insert \\partial;rot;concat;swap;insert \\,;swap;concat;concat;insert \\partial;insert 2;superscript;swap;operator frac 2",M:"insert \\partial;swap;concat;insert \\partial;rot;concat;swap;insert \\,;swap;concat;concat;swap;insert \\partial;insert 2;superscript;swap;concat;swap;operator frac 2",g:"insert \\nabla;swap;concat",G:"insert \\nabla;swap;subscript;swap;concat",".":"insert \\nabla;insert \\cdot;concat;swap;concat",c:"insert \\nabla;insert \\times;concat;swap;concat",l:"insert \\nabla;insert 2;superscript;swap;concat",L:"insert \\Box;insert 2;superscript;swap;concat",d:"insert d;operator mathrm;swap;concat",2:"insert d;operator mathrm;insert 2;superscript;swap;concat",3:"insert d;operator mathrm;insert 3;superscript;swap;concat",4:"insert d;operator mathrm;insert 4;superscript;swap;concat",i:"swap;insert \\,;concat;swap;insert d;operator mathrm;swap;concat;concat",I:"insert d;operator mathrm;swap;concat;concat;insert \\,;concat","?":"toggle_popup help derivatives"},infix:{a:"apply_infix",b:"infix \\bullet",c:"infix \\cap",d:"infix \\setminus",e:"infix ,\\dots,",f:"conjunction if",F:"conjunction iff",g:"infix \\gets",k:"insert \\,;swap;concat;swap;insert \\,;concat;swap;delimiters . . \\vert 2",l:"infix \\parallel",m:"infix \\mapsto",M:"infix \\mp",n:"conjunction when",o:"infix \\circ",O:"stackrel overset",p:"infix \\perp",P:"infix \\pm",q:"conjunction and",Q:"conjunction or",r:"conjunction for",s:"infix \\,",t:"infix \\to",T:"infix \\longrightarrow",u:"infix \\cup",U:"stackrel underset",v:"infix \\vee",w:"infix \\wedge",x:"infix \\times",X:"infix \\otimes","[":"infix \\llcorner","]":"infix \\lrcorner","|":"delimiters . . \\vert 2","=":"infix \\Rightarrow","-":"infix \\ominus","+":"infix \\oplus",".":"infix \\cdot",",":"infix ,"," ":"infix ,\\,",":":"infix :",";":"infix semicolon\\:","`":"swap;insert T;superscript;swap;concat","%":"infix \\pmod","*":"infix *","\\":"delimiters . . / 2","/":"infix /",">":"infix \\cdots","?":"toggle_popup help infix"},relational:{a:"infix \\approx",c:"infix \\cong",e:"infix \\equiv",E:"infix \\iff",g:"infix >",G:"infix \\gg",i:"infix \\in",I:"infix \\notin",l:"infix <",L:"infix \\ll",n:"infix \\ne",p:"infix \\propto",q:"infix =",s:"infix \\subseteq",S:"infix \\subset",t:"infix \\sim","=":"infix =","<":"infix \\le",">":"infix \\ge","[":"infix \\le","]":"infix \\ge",":":"infix \\coloneqq","~":"infix \\sim","|":"infix \\vDash","?":"toggle_popup help relational"},symbol:{0:"insert \\varnothing",1:"insert -1",2:"insert 1;insert 2;operator frac 2",3:"insert 1;insert 2;infix /",8:"insert \\infty",a:"insert \\forall",c:"insert \\cdot",C:"insert \\bigcap",d:"insert \\partial",e:"insert \\exists",h:"insert \\hslash",i:"insert \\int",I:"insert \\iint",l:"insert \\ell",M:"insert \\mp",o:"insert \\circ",p:"insert \\prod",P:"insert \\pm",q:"insert ?",s:"insert \\sum",U:"insert \\bigcup",v:"insert \\vee",w:"insert \\wedge",y:"insert \\oint",Y:"insert \\oiint",".":"insert \\dots",">":"insert \\cdots","-":"insert -","+":"insert +","*":"insert \\star","|":"insert |","=":"insert_separator hrule","?":"insert ?","!":"insert !",",":"insert ,",";":"insert semicolon",":":"insert :","`":"insert `","'":"insert_defer"," ":"insert ",ArrowUp:"insert \\uparrow",ArrowDown:"insert \\downarrow"},decoration:{0:"insert 0;subscript",1:"insert -1;superscript",2:"insert 2;superscript",3:"insert 3;superscript",4:"insert 4;superscript",8:"insert \\infty;infix \\to",a:"operator overrightarrow",b:"operator mathbb",c:"autoparenthesize;insert 1;swap;infix -",C:"mode color",d:"insert \\dagger;superscript",D:"insert \\ddagger;superscript",e:"operator bold",f:"prefix \\therefore",F:"prefix \\because",g:"operator mathring",G:"operator grave",h:"apply_hat hat",H:"apply_hat widehat",i:"insert -;superscript",I:"insert +;superscript",k:"operator mathfrak",l:"insert \\parallel;subscript",m:"operator mathtt",M:"prefix \\mp",o:"operator bar",O:"operator overline",p:"insert \\perp;subscript",P:"prefix \\pm",r:"operator mathrm",s:"operator mathsf",t:"prefix \\to",T:"operator widetilde",u:"apply_hat breve",U:"operator utilde",v:"operator vec",V:"apply_hat check",w:"apply_hat widehat",W:"apply_hat widecheck",x:"operator boxed",X:"operator sout",".":"apply_hat dot",'"':"apply_hat ddot"," ":"insert \\,;concat","'":"autoparenthesize;prime","*":"insert *;superscript","~":"apply_hat tilde","=":"prefix \\Rightarrow","-":"prefix -","+":"prefix +","`":"insert T;superscript","/":"operator cancel","\\":"operator bcancel",_:"operator underline","?":"toggle_popup help decorations"},color:{b:"color blue",g:"color green",h:"color #888",k:"color black",o:"color orange",p:"color purple",r:"color red",y:"color #ff0"},array:{"[digit]":"prefix_argument",a:"build_align aligned",c:"build_align cases",C:"build_align rcases",d:"dissolve_matrix",e:"build_list ,\\,;insert ,\\,\\dots;concat",E:"insert_matrix_ellipses",f:"build_align cases_if",F:"build_align rcases_if",g:"build_align gathered",k:"build_substack",m:"build_matrix_row matrix",p:"build_list +;insert +\\cdots;concat",s:"split_matrix",T:"matrix_transpose",v:"build_matrix_row vmatrix",V:"build_matrix_row Vmatrix","|":"stack_matrices",",":"build_list ,"," ":"build_list ,\\,",".":"build_list ,\\, ,\\,\\dots,\\,",";":"build_list semicolon\\,","+":"build_infix_list + \\cdots","(":"build_matrix_row pmatrix","[":"build_matrix_row bmatrix","{":"build_matrix_row Bmatrix","@":"build_matrix_row bmatrix 2;matrix_transpose","#":"build_matrix_row bmatrix 3;matrix_transpose",$:"build_matrix_row bmatrix 2;unrot;build_matrix_row bmatrix 2;swap;stack_matrices",Enter:"stack_matrices","?":"toggle_popup help arrays"},script:{"[alpha]":"self_insert;to_case uppercase;operator mathscr","&":"insert \\&"},calligraphic:{"[alpha]":"self_insert;to_case uppercase;operator mathcal","%":"insert \\%"},lowercase_greek:{a:"insert \\alpha",b:"insert \\beta",c:"insert \\chi",d:"insert \\delta",e:"insert \\epsilon",f:"insert \\phi",g:"insert \\gamma",h:"insert \\eta",i:"insert \\iota",j:"insert \\varphi",k:"insert \\kappa",l:"insert \\lambda",m:"insert \\mu",n:"insert \\nu",o:"insert \\omega",p:"insert \\pi",q:"insert \\vartheta",r:"insert \\rho",s:"insert \\sigma",t:"insert \\tau",u:"insert \\upsilon",v:"insert \\theta",w:"insert \\omega",x:"insert \\xi",y:"insert \\psi",z:"insert \\zeta",":":"mode variant_greek",";":"infix semicolon","?":"toggle_popup help greek"},uppercase_greek:{d:"insert \\Delta",e:"insert \\varepsilon",f:"insert \\Phi",g:"insert \\Gamma",k:"insert \\varkappa",l:"insert \\Lambda",m:"insert \\varpi",o:"insert \\Omega",p:"insert \\Pi",q:"insert \\vartheta",r:"insert \\varrho",s:"insert \\Sigma",t:"insert \\varsigma",u:"insert \\Upsilon",v:"insert \\Theta",w:"insert \\Omega",x:"insert \\Xi",y:"insert \\Psi",6:"insert \\digamma","^":"insert \\digamma",n:"insert \\nabla",D:"insert \\Delta",E:"insert \\varepsilon",F:"insert \\Phi",G:"insert \\Gamma",K:"insert \\varkappa",L:"insert \\Lambda",M:"insert \\varpi",O:"insert \\Omega",P:"insert \\Pi",Q:"insert \\vartheta",R:"insert \\varrho",S:"insert \\Sigma",T:"insert \\varsigma",U:"insert \\Upsilon",V:"insert \\Theta",W:"insert \\Omega",X:"insert \\Xi",Y:"insert \\Psi",N:"insert \\nabla",":":"infix :","?":"toggle_popup help greek"},variant_greek:{d:"insert \\varDelta",D:"insert \\varDelta",f:"insert \\varPhi",F:"insert \\varPhi",g:"insert \\varGamma",G:"insert \\varGamma",l:"insert \\varLambda",L:"insert \\varLambda",o:"insert \\varOmega",O:"insert \\varOmega",p:"insert \\varPi",P:"insert \\varPi",q:"insert \\varTheta",Q:"insert \\varTheta",s:"insert \\varSigma",S:"insert \\varSigma",u:"insert \\varUpsilon",U:"insert \\varUpsilon",x:"insert \\varXi",X:"insert \\varXi",y:"insert \\varPsi",Y:"insert \\varPsi","?":"toggle_popup help greek"}},g=n(17),k=n.n(g),b=function(){function e(){Object(u.a)(this,e),this.bindings=y}return Object(l.a)(e,[{key:"lookup_binding",value:function(e,t){var n=this.bindings[e];return n?n[t]?n[t]:n["[alpha]"]&&/^[a-zA-Z]$/.test(t)?n["[alpha]"]:n["[digit]"]&&/^[0-9]$/.test(t)?n["[digit]"]:n["[alnum]"]&&/^[a-zA-Z0-9]$/.test(t)?n["[alnum]"]:n.default?n.default:"base"===e||"editor"===e?null:"cancel":null}}]),e}(),w=function(){function e(){Object(u.a)(this,e),this.current_keymap=new b,this.selected_theme="default",this.last_opened_filename=null,this.popup_mode=null,this.layout=this.default_layout()}return Object(l.a)(e,[{key:"default_layout",value:function(){return{zoom_factor:0,stack_rightalign_math:!1,document_rightalign_math:!1,inline_math:!1,stack_side:"left",stack_split:50}}},{key:"apply_layout_to_dom",value:function(e,t,n){var r=this.layout;n.style.display=this.popup_mode?"block":"none";var i=document.getElementById("root"),s=Math.round(100*Math.pow(1.05,r.zoom_factor||0));i.style.fontSize=s+"%";var a=this._split_rectangle({x:0,y:0,w:100,h:100},r.stack_side,r.stack_split),o=Object(c.a)(a,2),u=o[0],l=o[1];this._apply_bounds(e,u),this._apply_bounds(t,l)}},{key:"_split_rectangle",value:function(e,t,n){var r=Math.round(n*e.w/100),i=e.w-r,s=Math.round(n*e.h/100),a=e.h-s;switch(t){case"left":return[{x:e.x,y:e.y,w:r,h:e.h},{x:e.x+r,y:e.y,w:i,h:e.h}];case"right":return[{x:e.x+i,y:e.y,w:r,h:e.h},{x:e.x,y:e.y,w:i,h:e.h}];case"top":return[{x:e.x,y:e.y,w:e.w,h:s},{x:e.x,y:e.y+s,w:e.w,h:a}];case"bottom":return[{x:e.x,y:e.y+a,w:e.w,h:s},{x:e.x,y:e.y,w:e.w,h:a}];default:return[e,e]}}},{key:"_apply_bounds",value:function(e,t){e.style.left=t.x+"%",e.style.top=t.y+"%",e.style.width=t.w+"%",e.style.height=t.h+"%"}},{key:"save",value:function(){var e=JSON.stringify(this.to_json());localStorage.setItem("settings",e)}},{key:"to_json",value:function(){var t=this,n={};return e.saved_keys.forEach((function(e){n[e]=t[e]})),n}}],[{key:"load_from_local_storage",value:function(){var t=localStorage.getItem("settings");return t?e.from_json(JSON.parse(t)):new e}},{key:"from_json",value:function(t){var n=new e;return e.saved_keys.forEach((function(e){n[e]=t[e]})),n}}]),e}();w.saved_keys=["selected_theme","last_opened_filename","popup_mode","layout"];var j=function(){function e(){Object(u.a)(this,e),this.tokens=[],this.last_token_type=null}return Object(l.a)(e,[{key:"emit_token",value:function(e,t){e.length>0&&(this.tokens.push(e),this.last_token_type=t)}},{key:"expr",value:function(e){e.emit_latex(this)}},{key:"grouped_expr",value:function(e,t){var n=this;this.grouped((function(){return n.expr(e)}),t)}},{key:"grouped",value:function(e,t){var n=[this.tokens,this.last_token_type],r=n[0],i=n[1],s=[[],null];this.tokens=s[0],this.last_token_type=s[1],e();var a=[this.tokens,this.last_token_type],o=a[0],c=a[1];this.tokens=r,this.last_token_type=i,"force"===t||0===o.length||o.length>1?(this.text("{"),this.text(o.join("")),this.text("}")):"text"===c?1===o[0].length?this.text(o[0]):(this.text("{"),this.text(o[0]),this.text("}")):"force_commands"===t?(this.text("{"),this.emit_token(o[0],"command"),this.text("}")):this.emit_token(o[0],"command")}},{key:"text",value:function(e){if("command"===this.last_token_type){var t=this.tokens[this.tokens.length-1];this._is_latex_identifier_char(t.charAt(t.length-1))&&this._is_latex_identifier_char(e.charAt(0))&&this.emit_token(" ","text")}this.emit_token(e,"text")}},{key:"_is_latex_identifier_char",value:function(e){return/^[a-zA-Z]$/.test(e)}},{key:"command",value:function(e,t){t&&(e=e+"["+t+"]"),this.emit_token("\\"+e,"command")}},{key:"text_or_command",value:function(e){e.startsWith("\\")?this.command(e.slice(1)):this.text(e)}},{key:"begin_environment",value:function(e){this.text("\\begin{"+e+"}\n")}},{key:"end_environment",value:function(e){this.text("\n\\end{"+e+"}\n")}},{key:"align_separator",value:function(){this.text(" & ")}},{key:"row_separator",value:function(){this.text("\\\\[0.1em]\n")}},{key:"finished_string",value:function(){return this.tokens.join("")}}]),e}(),O=function(){function e(t,n){Object(u.a)(this,e),this.stack=t||this._default_stack(),this.document=n||new X([],0),this.is_dirty=!1}return Object(l.a)(e,[{key:"_default_stack",value:function(){var e=H.from_string("Welcome to the editor.  Press [?] to toggle help.");return new K([e])}},{key:"same_as",value:function(e){return this.stack===e.stack&&this.document===e.document}},{key:"to_json",value:function(){return{stack:this.stack.to_json(),document:this.document.to_json(),format:1}}}],[{key:"from_json",value:function(t){return new e(K.from_json(t.stack),X.from_json(t.document))}}]),e}(),z=function(){function e(){Object(u.a)(this,e),this.state_stack=[],this.max_stack_depth=100,this.undo_count=0}return Object(l.a)(e,[{key:"clear",value:function(e){this.state_stack=[e],this.undo_count=0}},{key:"push_state",value:function(e){return this.state_stack.length>this.undo_count&&this.state_stack[this.state_stack.length-this.undo_count-1].same_as(e)?null:(this.undo_count>0&&(this.state_stack=this.state_stack.slice(0,this.state_stack.length-this.undo_count),this.undo_count=0),this.state_stack.push(e),this.state_stack.length>this.max_stack_depth&&(this.state_stack=this.state_stack.slice(this.state_stack.length-this.max_stack_depth)),e)}},{key:"undo_state",value:function(){return this.state_stack.length-1>this.undo_count?(this.undo_count++,this.state_stack[this.state_stack.length-this.undo_count-1]):null}},{key:"redo_state",value:function(){return this.undo_count>0?(this.undo_count--,this.state_stack[this.state_stack.length-this.undo_count-1]):null}}]),e}(),C=function(){function e(){Object(u.a)(this,e),this.open_request=null,this.database=null}return Object(l.a)(e,[{key:"open_database",value:function(e){indexedDB&&(this.on_open_success=e,this.open_request=indexedDB.open("rpnlatex",1),this.open_request.onupgradeneeded=this.handle_upgrade_database.bind(this),this.open_request.onsuccess=this.handle_open_success.bind(this),this.open_request.onerror=this.handle_open_error.bind(this))}},{key:"handle_upgrade_database",value:function(e){switch(this.database=this.open_request.result,e.oldVersion){case 0:this.build_initial_schema()}}},{key:"build_initial_schema",value:function(){this.database.createObjectStore("documents",{keyPath:"filename"}),this.database.createObjectStore("documents_metadata",{keyPath:"filename"})}},{key:"handle_open_error",value:function(e){this.open_request=null}},{key:"handle_open_success",value:function(e){this.database=this.open_request.result,this.open_request=null,this.database.onversionchange=function(){this.database.close(),this.database=null,alert("Warning: database is outdated, please reload the page.")},this.on_open_success&&this.on_open_success()}},{key:"create_transaction",value:function(e){return this.database.transaction(["documents","documents_metadata"],e?"readwrite":"readonly")}},{key:"sanitize_filename",value:function(e){var t=e.replaceAll(/[^a-zA-Z0-9_ ]/g,"").trim();return 0===t.length||t.length>200?null:t}},{key:"load_state",value:function(e,t,n){if(!this.database)return n();var r=this.create_transaction(!1).objectStore("documents").get(e);r.onsuccess=function(){if(r.result){var i=O.from_json(r.result);t(e,i)}else n(e,"???")},r.onerror=function(){n(e,"???")}}},{key:"save_state",value:function(e,t,n,r){if(!this.database)return r();var i=e.to_json();i.filename=t;var s={filename:t,filesize:JSON.stringify(i).length,description:"",stack_item_count:e.stack.depth(),document_item_count:e.document.items.length,timestamp:new Date},a=this.create_transaction(!0);a.objectStore("documents").put(i),a.objectStore("documents_metadata").put(s),n&&(a.oncomplete=n),r&&(a.onabort=r)}},{key:"delete_state",value:function(e,t,n){if(!this.database)return n();var r=this.create_transaction(!0);r.objectStore("documents").delete(e),r.objectStore("documents_metadata").delete(e),t&&(r.oncomplete=t),n&&(r.onabort=n)}},{key:"fetch_file_list",value:function(e,t){if(!this.database)return t();var n=this.create_transaction(!1).objectStore("documents_metadata").getAll();n.onsuccess=function(){n.result.forEach((function(e){var t=Date.parse(e.timestamp);e.timestamp=t?new Date(t):null})),e(n.result)},n.onerror=t}},{key:"fetch_all_documents",value:function(e,t,n){if(!this.database)return n();var r=this.create_transaction(!1).objectStore("documents").openCursor();r.onsuccess=function(n){var r=n.target.result;r?(e(r.value),r.continue()):t()},r.onerror=n}}]),e}(),E=function(){function e(){Object(u.a)(this,e),this.state="idle",this.document_storage=null,this.import_count=0,this.failed_count=0,this.error_message=null,this.download_url=null,this.import_result_string=null,this.file_list_needs_update=!1,this.onstatechange=null}return Object(l.a)(e,[{key:"textual_state",value:function(){switch(this.state){case"idle":return this.download_url?"Download Ready":"Ready for export or import";case"error":return"Error: "+this.error_message;case"loading":return"Extacting database...";case"zipping":return"Compressing files...";case"uploading":return"Uploading data...";case"importing":return"Importing documents: "+this.import_count+" so far";default:return"???"}}},{key:"download_available",value:function(){return"idle"===this.state&&this.download_url}},{key:"generate_download_filename",value:function(){var e=new Date;return["rpnlatex_",e.getFullYear().toString(),"_",e.toLocaleString("default",{month:"short"}).toLowerCase(),"_",e.getDate().toString().padStart(2,"0"),".zip"].join("")}},{key:"change_state",value:function(e){this.state=e,this.onstatechange&&this.onstatechange(this)}},{key:"start_exporting",value:function(){var e=this,t=this.document_storage;this.zip=new k.a,t.fetch_all_documents((function(t){return e.add_document_json_to_zip(t)}),(function(){return e.start_compressing()}),(function(){e.error_message="Unable to export the document database.",e.change_state("error")})),this.change_state("loading")}},{key:"add_document_json_to_zip",value:function(e){this.zip.file(e.filename+".json",JSON.stringify(e))}},{key:"start_compressing",value:function(){var e=this;this.change_state("zipping"),this.zip.generateAsync({type:"blob"}).then((function(t){e.finished_compressing(t)}))}},{key:"clear_download_url",value:function(){this.download_url&&(URL.revokeObjectURL(this.download_url),this.download_url=null)}},{key:"finished_compressing",value:function(e){this.clear_download_url(),this.download_url=URL.createObjectURL(e),this.zip=null,this.change_state("idle")}},{key:"start_importing",value:function(e){var t=this;if(this.clear_download_url(),this.import_result_string=null,"application/zip"===e.type){this.change_state("uploading");var n=new FileReader;n.addEventListener("load",(function(e){return t.process_uploaded_data(e.target.result)})),n.readAsArrayBuffer(e)}else alert("Import files must be zip archives.")}},{key:"process_uploaded_data",value:function(e){var t=this;this.import_count=0,this.failed_count=0,this.error_message=null,this.change_state("importing"),k.a.loadAsync(e).then((function(e){var n=[],r=function(r){var i=e.files[r];r.endsWith(".json")?n.push(i.async("string").then((function(e){return t.import_file(i.name.slice(0,i.name.length-5),e)}))):(t.error_message="Invalid filename in archive: "+r,t.failed_count++)};for(var i in e.files)r(i);Promise.all(n).then((function(){t.failed_count>0?t.import_result_string="Errors encountered: "+t.error_message:t.import_result_string="Successfully imported "+t.import_count+" document"+(1===t.import_count?"":"s"),t.change_state("idle"),t.file_list_needs_update=!0}))}))}},{key:"import_file",value:function(e,t){var n,r,i=this.document_storage;try{n=JSON.parse(t),r=O.from_json(n)}catch(s){return this.error_message="Invalid document found in zip file: "+e,void this.failed_count++}i.save_state(r,e),this.import_count++,this.change_state("importing")}}]),e}(),S=function(){function e(t,n,r){Object(u.a)(this,e),this.file_list=t,this.selected_filename=n,this.current_filename=r,this.unavailable=!1}return Object(l.a)(e,[{key:"sort_file_list",value:function(e,t){this.file_list.sort((function(n,r){var i=n[e],s=r[e];return(t?1:-1)*(i===s?0:i<s?-1:1)}))}},{key:"generate_unused_filename",value:function(e){var t=this;if(this.unavailable||!this.file_list)return e;e=e.replace(/_\d+$/,"");for(var n=function(n){var r=e+"_"+n;if(!t.file_list.some((function(e){return e.filename===r})))return{v:r}},r=1;r<1e3;r++){var i=n(r);if("object"===typeof i)return i.v}return e+"_toomany"}},{key:"find_adjacent_filename",value:function(e,t){if(this.unavailable||!this.file_list)return null;var n=null,r=this.file_list;return r.forEach((function(i,s){if(i.filename===e){var a=s+t;a<0&&(a=0),a>=r.length&&(a=r.length-1),n=r[a].filename}})),!n&&r.length>0&&(n=r[0].filename),n}}]),e}(),q=function(){function e(){Object(u.a)(this,e)}return Object(l.a)(e,[{key:"expr_type",value:function(){return"???"}},{key:"to_latex",value:function(){var e=new j;return this.emit_latex(e),e.finished_string()}},{key:"emit_latex",value:function(e){e.text("INVALID")}},{key:"json_keys",value:function(){return[]}},{key:"to_json",value:function(){var t=this,n={expr_type:this.expr_type()};return this.json_keys().forEach((function(r){var i,s=t[r];i=null===s||void 0===s?null:"object"===typeof s&&s instanceof e?s.to_json():"object"===typeof s?s.map((function(e){return e.to_json()})):s,n[r]=i})),n}},{key:"to_text",value:function(){return"$$\n"+this.to_latex()+"\n$$"}},{key:"visit",value:function(e){e(this)}},{key:"find_defer",value:function(){var e=null;return this.visit((function(t){"defer"!==t.expr_type()||e||(e=t)})),e}},{key:"substitute_expr",value:function(e,t){return this===e?t:this}},{key:"as_bold",value:function(){return"command"===this.expr_type()&&"boldsymbol"===this.command_name?this:new N("boldsymbol",[this])}}],[{key:"from_json",value:function(e){switch(e.expr_type){case"command":return new N(e.command_name,this._list(e.operand_exprs),e.options);case"prefix":return new A(this._expr(e.base_expr),this._expr(e.prefix_expr));case"infix":return new D(this._expr(e.operator_expr),this._expr(e.left_expr),this._expr(e.right_expr),e.split||null);case"defer":return new T;case"text":return new I(e.text);case"sequence":return new L(this._list(e.exprs));case"delimiter":return new U(e.left_type,e.right_type,e.middle_type,this._list(e.inner_exprs));case"subscriptsuperscript":return new P(this._expr(e.base_expr),this._expr(e.subscript_expr),this._expr(e.superscript_expr));case"array":return new B(e.array_type,e.row_count,e.column_count,this._list2d(e.element_exprs));default:return new I("invalid expr type "+e.expr_type)}}},{key:"_expr",value:function(t){return t?e.from_json(t):null}},{key:"_list",value:function(t){return t.map((function(t){return e.from_json(t)}))}},{key:"_list2d",value:function(t){return t.map((function(t){return e._list(t)}))}},{key:"combine_pair",value:function(t,n){var r=t.expr_type(),i=n.expr_type();return"sequence"===r&&"sequence"===i?new L(t.exprs.concat(n.exprs)):"text"===r&&"text"===i?new I(t.text+n.text):"sequence"===r&&"text"===i&&"text"===t.exprs[t.exprs.length-1].expr_type()?new L(t.exprs.slice(0,-1).concat([new I(t.exprs[t.exprs.length-1].text+n.text)])):"text"===r&&"text"===i&&"text"===n.exprs[0].expr_type()?new L([new I(t.text+n.exprs[0].text)].concat(n.exprs.slice(1))):"command"===r&&"command"===i?e.combine_command_pair(t,n):new L([t,n])}},{key:"combine_command_pair",value:function(e,t){var n=e.command_name,r=t.command_name,i=null;return"int"===n&&"int"===r&&(i="iint"),"iint"===n&&"int"===r&&(i="iiint"),"int"===n&&"iint"===r&&(i="iiint"),"oint"===n&&"oint"===r&&(i="oiint"),"oiint"===n&&"oint"===r&&(i="oiiint"),"oint"===n&&"oiint"===r&&(i="oiiint"),i?new N(i):new L([e,t])}}]),e}(),N=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(e,r,i){var s;if(Object(u.a)(this,n),s=t.call(this),e.endsWith("]")){var a=e.indexOf("[");s.command_name=e.slice(0,a),s.options=e.slice(a+1,e.length-1)}else s.command_name=e,s.options=void 0===i?null:i;return s.operand_exprs=r||[],s}return Object(l.a)(n,[{key:"operand_count",value:function(){return this.operand_exprs.length}},{key:"expr_type",value:function(){return"command"}},{key:"json_keys",value:function(){return["command_name","operand_exprs","options"]}},{key:"emit_latex",value:function(e){e.command(this.command_name,this.options),this.operand_exprs.forEach((function(t){return e.grouped_expr(t,"force")}))}},{key:"visit",value:function(e){e(this),this.operand_exprs.forEach((function(t){return t.visit(e)}))}},{key:"substitute_expr",value:function(e,t){return this===e?t:new n(this.command_name,this.operand_exprs.map((function(n){return n.substitute_expr(e,t)})),this.options)}}]),n}(q),A=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(e,r){var i;return Object(u.a)(this,n),(i=t.call(this)).base_expr=e,i.prefix_expr=r,i}return Object(l.a)(n,[{key:"expr_type",value:function(){return"prefix"}},{key:"json_keys",value:function(){return["base_expr","prefix_expr"]}},{key:"emit_latex",value:function(e){e.expr(this.prefix_expr),e.expr(this.base_expr)}},{key:"visit",value:function(e){this.prefix_expr.visit(e),e(this),this.base_expr.visit(e)}},{key:"substitute_expr",value:function(e,t){return this===e?t:new n(this.base_expr.substitute_expr(e,t),this.prefix_expr.substitute_expr(e,t))}}]),n}(q),D=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(e,r,i,s){var a;return Object(u.a)(this,n),(a=t.call(this)).operator_expr=e,a.left_expr=r,a.right_expr=i,a.split=s||null,a}return Object(l.a)(n,[{key:"expr_type",value:function(){return"infix"}},{key:"json_keys",value:function(){return["operator_expr","left_expr","right_expr","split"]}},{key:"operator_text",value:function(){var e=this.operator_expr;return"command"===e.expr_type()&&0===e.operand_count()?e.command_name:"text"===e.expr_type()?e.text:null}},{key:"needs_autoparenthesization",value:function(){var e=this.operator_text();return e&&("+"===e||"-"===e)}},{key:"emit_latex",value:function(e){this.left_expr&&e.expr(this.left_expr),"before"===this.split&&(e.command("\\"),e.command("qquad")),e.expr(this.operator_expr),"after"===this.split&&(e.command("\\"),e.command("qquad")),this.right_expr&&e.expr(this.right_expr)}},{key:"visit",value:function(e){this.left_expr&&this.left_expr.visit(e),this.operator_expr.visit(e),e(this),this.right_expr&&this.right_expr.visit(e)}},{key:"substitute_expr",value:function(e,t){return this===e?t:new n(this.operator_expr.substitute_expr(e,t),this.left_expr.substitute_expr(e,t),this.right_expr.substitute_expr(e,t),this.split)}},{key:"with_split_mode",value:function(e){return new n(this.operator_expr,this.left_expr,this.right_expr,e)}}]),n}(q),T=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"expr_type",value:function(){return"defer"}},{key:"json_keys",value:function(){return[]}},{key:"emit_latex",value:function(e){var t=new N("htmlClass",[new I("defer_expr"),new I("\\blacksquare")]);e.expr(t)}}]),n}(q),I=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(u.a)(this,n),(r=t.call(this)).text=e,r}return Object(l.a)(n,[{key:"expr_type",value:function(){return"text"}},{key:"json_keys",value:function(){return["text"]}},{key:"emit_latex",value:function(e){e.text(this.text)}}]),n}(q),L=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(u.a)(this,n),(r=t.call(this)).exprs=e,r}return Object(l.a)(n,[{key:"expr_type",value:function(){return"sequence"}},{key:"json_keys",value:function(){return["exprs"]}},{key:"emit_latex",value:function(e){this.exprs.forEach((function(t){return e.expr(t)}))}},{key:"visit",value:function(e){e(this),this.exprs.forEach((function(t){return t.visit(e)}))}},{key:"substitute_expr",value:function(e,t){return this===e?t:new n(this.exprs.map((function(n){return n.substitute_expr(e,t)})))}}]),n}(q),U=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(e,r,i,s){var a;return Object(u.a)(this,n),(a=t.call(this)).left_type=e,a.right_type=r,a.middle_type=i||null,a.inner_exprs=s||[],a}return Object(l.a)(n,[{key:"expr_type",value:function(){return"delimiter"}},{key:"json_keys",value:function(){return["left_type","right_type","middle_type","inner_exprs"]}},{key:"emit_latex",value:function(e){var t=this;e.command("left"),e.text_or_command(this.left_type),this.inner_exprs.forEach((function(n,r){r>0&&(e.command("middle"),e.text_or_command(t.middle_type||"|")),e.expr(n)})),e.command("right"),e.text_or_command(this.right_type)}},{key:"visit",value:function(e){e(this),this.inner_exprs.forEach((function(t){return t.visit(e)}))}},{key:"substitute_expr",value:function(e,t){return this===e?t:new n(this.left_type,this.right_type,this.middle_type,this.inner_exprs.map((function(n){return n.substitute_expr(e,t)})))}}],[{key:"parenthesize",value:function(e){return new n("(",")",null,[e])}},{key:"autoparenthesize",value:function(e){return"infix"===e.expr_type()&&e.needs_autoparenthesization()?n.parenthesize(e):e}}]),n}(q),P=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(e,r,i){var s;return Object(u.a)(this,n),(s=t.call(this)).base_expr=e,s.subscript_expr=r,s.superscript_expr=i,s}return Object(l.a)(n,[{key:"expr_type",value:function(){return"subscriptsuperscript"}},{key:"json_keys",value:function(){return["base_expr","subscript_expr","superscript_expr"]}},{key:"emit_latex",value:function(e){"command"===this.base_expr.expr_type()?e.expr(this.base_expr):e.grouped_expr(this.base_expr),this.subscript_expr&&(e.text("_"),e.grouped_expr(this.subscript_expr,"force_commands")),this.superscript_expr&&(e.text("^"),e.grouped_expr(this.superscript_expr,"force_commands"))}},{key:"visit",value:function(e){e(this),this.base_expr.visit(e),this.subscript_expr&&this.subscript_expr.visit(e),this.superscript_expr&&this.superscript_expr.visit(e)}},{key:"substitute_expr",value:function(e,t){return this===e?t:new n(this.base_expr.substitute_expr(e,t),this.subscript_expr?this.subscript_expr.substitute_expr(e,t):null,this.superscript_expr?this.superscript_expr.substitute_expr(e,t):null)}}]),n}(q),B=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(e,r,i,s){var a;return Object(u.a)(this,n),(a=t.call(this)).array_type=e,a.row_count=r,a.column_count=i,a.element_exprs=s,a}return Object(l.a)(n,[{key:"expr_type",value:function(){return"array"}},{key:"json_keys",value:function(){return["array_type","row_count","column_count"]}},{key:"is_matrix",value:function(){var e=this.array_type;return"bmatrix"===e||"Bmatrix"===e||"matrix"===e||"pmatrix"===e||"vmatrix"===e||"Vmatrix"===e}},{key:"to_json",value:function(){var e=Object(x.a)(Object(v.a)(n.prototype),"to_json",this).call(this);return e.element_exprs=this.element_exprs.map((function(e){return e.map((function(e){return e.to_json()}))})),e}},{key:"with_ellipses",value:function(){var e=this;if(this.row_count<=1||this.column_count<=1)return this;for(var t=function(e){return new I(e)},r=this.element_exprs.map((function(n,r){return[].concat(Object(o.a)(n.slice(0,-1)),[t(0===r||r===e.row_count-1?"\\cdots":""),n[e.column_count-1]])})),i=[t("\\vdots")],s=0;s<this.column_count-2;s++)i.push(t(""));return i.push(t("\\ddots")),i.push(t("\\vdots")),r.splice(this.row_count-1,0,i),new n(this.array_type,this.row_count+1,this.column_count+1,r)}},{key:"transposed",value:function(){for(var e=this,t=[],r=function(n){t.push(e.element_exprs.map((function(t){return e._transpose_cell(t[n])})))},i=0;i<this.column_count;i++)r(i);return new n(this.array_type,this.column_count,this.row_count,t)}},{key:"_transpose_cell",value:function(e){if("text"===e.expr_type())switch(e.text){case"\\vdots":return new I("\\cdots");case"\\cdots":return new I("\\vdots")}return e}},{key:"split_rows",value:function(){var e=this;return this.element_exprs.map((function(t){return new n(e.array_type,1,e.column_count,[t])}))}},{key:"emit_latex",value:function(e){e.begin_environment(this.array_type),this.element_exprs.forEach((function(t,n){n>0&&e.row_separator(),t.forEach((function(t,n){n>0&&e.align_separator(),t&&e.expr(t)}))})),e.end_environment(this.array_type)}},{key:"visit",value:function(e){e(this),this.element_exprs.forEach((function(t){return t.forEach((function(t){return t.visit(e)}))}))}},{key:"substitute_expr",value:function(e,t){if(this===e)return t;var r=this.element_exprs.map((function(n){return n.map((function(n){return n.substitute_expr(e,t)}))}));return new n(this.array_type,this.row_count,this.column_count,r)}}],[{key:"split_elements",value:function(e,t){return e.map((function(e){return n._split_expr(e,t)}))}},{key:"_split_expr",value:function(e,t){switch(t){case"none":return[e];case"infix":return"infix"===e.expr_type()?[e.left_expr,new D(e.operator_expr,null,e.right_expr)]:[e,null];case"colon":return"infix"===e.expr_type()&&":"===e.operator_text()?[e.left_expr,e.right_expr]:[e,null];case"colon_if":return"infix"===e.expr_type()&&":"===e.operator_text()?[e.left_expr,q.combine_pair(q.combine_pair(new N("mathrm",[new I("if")]),new N("enspace"),[]),e.right_expr)]:[e,new N("mathrm",[new I("otherwise")])];default:return[e]}}}]),n}(q),R=function(){function e(){Object(u.a)(this,e),this.serial=e.next_serial()}return Object(l.a)(e,[{key:"react_key",value:function(e){return e+"_"+this.serial}},{key:"item_type",value:function(){return"???"}},{key:"to_json",value:function(){return{}}},{key:"to_text",value:function(){return"???"}},{key:"clone",value:function(){return null}}],[{key:"next_serial",value:function(){return e.serial_number++}},{key:"from_json",value:function(e){switch(e.item_type){case"expr":return new $(q.from_json(e.expr),e.tag_expr?q.from_json(e.tag_expr):null);case"text":return new H(e.elements.map((function(e){return W.from_json(e)})),!!e.is_heading);case"separator":return new M(e.separator_type);default:return H.from_string("invalid item type "+e.item_type)}}}]),e}();R.serial_number=1;var $=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(e,r){var i;return Object(u.a)(this,n),(i=t.call(this)).expr=e,i.tag_expr=r,i}return Object(l.a)(n,[{key:"item_type",value:function(){return"expr"}},{key:"to_json",value:function(){var e={item_type:"expr",expr:this.expr.to_json()};return this.tag_expr&&(e.tag_expr=this.tag_expr.to_json()),e}},{key:"to_text",value:function(){return this.expr.to_text()}},{key:"clone",value:function(){return new n(this.expr,this.tag_expr)}}]),n}(R),M=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(u.a)(this,n),(r=t.call(this)).separator_type=e,r}return Object(l.a)(n,[{key:"item_type",value:function(){return"separator"}},{key:"to_json",value:function(){return{item_type:"separator",separator_type:this.separator_type}}},{key:"to_text",value:function(){return"\\rule"}},{key:"clone",value:function(){return new n(this.separator_type)}}]),n}(R),W=function(){function e(){Object(u.a)(this,e)}return Object(l.a)(e,[{key:"is_text",value:function(){return!1}},{key:"is_expr",value:function(){return!1}},{key:"is_raw",value:function(){return!1}}],[{key:"from_json",value:function(e){return e.expr?new F(q.from_json(e.expr)):e.text?new V(e.text,!!e.is_bold):new G(e.raw)}}]),e}(),V=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(e,r){var i;return Object(u.a)(this,n),(i=t.call(this)).text=e,i.is_bold=!!r,i}return Object(l.a)(n,[{key:"is_text",value:function(){return!0}},{key:"as_bold",value:function(){return new n(this.text,!0)}},{key:"to_json",value:function(){var e={text:this.text};return this.is_bold&&(e.is_bold=!0),e}},{key:"to_text",value:function(){return this.text}},{key:"to_latex",value:function(){for(var e=this.text.split(/ +/),t=[],n=0;n<e.length;n++)t.push("\\text{"),this.is_bold&&t.push("\\bf{}"),t.push(this._latex_escape(e[n])),n<e.length-1&&t.push(" "),t.push("}\\allowbreak ");return t.join("")}},{key:"_latex_escape",value:function(e){var t={_:"\\_","^":'\\char"005e',"%":"\\%",$:"\\$","&":"\\&","#":"\\#","}":"\\}","{":"\\{","~":'\\char"223c',"\\":"\\textbackslash "};return e.replaceAll(/[_^%$&#}{~\\]/g,(function(e){return t[e]}))}}]),n}(W),F=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(u.a)(this,n),(r=t.call(this)).expr=e,r}return Object(l.a)(n,[{key:"is_expr",value:function(){return!0}},{key:"as_bold",value:function(){return new n(this.expr.as_bold())}},{key:"to_json",value:function(){return{expr:this.expr.to_json()}}},{key:"to_text",value:function(){return"$"+this.expr.to_latex()+"$"}},{key:"to_latex",value:function(){return this.expr.to_latex()}}]),n}(W),G=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(u.a)(this,n),(r=t.call(this)).string=e,r}return Object(l.a)(n,[{key:"is_raw",value:function(){return!0}},{key:"as_bold",value:function(){return this}},{key:"to_json",value:function(){return{raw:this.string}}},{key:"to_text",value:function(){return this.string}},{key:"to_latex",value:function(){return this.string}},{key:"is_explicit_space",value:function(){return"\\,"===this.string}}]),n}(W),H=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(e,r){var i;return Object(u.a)(this,n),(i=t.call(this)).elements=e,i.is_heading=!!r,i}return Object(l.a)(n,[{key:"item_type",value:function(){return"text"}},{key:"to_json",value:function(){var e={item_type:"text",elements:this.elements.map((function(e){return e.to_json()}))};return this.is_heading&&(e.is_heading=!0),e}},{key:"to_text",value:function(){return this.elements.map((function(e){return e.to_text()})).join("")}},{key:"to_latex",value:function(){return this.elements.map((function(e){return e.to_latex()})).join("")}},{key:"clone",value:function(){return new n(this.elements,this.is_heading)}},{key:"as_bold",value:function(){return new n(this.elements.map((function(e){return e.as_bold()})),this.is_heading)}},{key:"try_substitute_defer",value:function(e){for(var t=Object(o.a)(this.elements),r=0;r<t.length;r++)if(t[r].is_expr()){var i=t[r].expr.find_defer();if(i){var s=t[r].expr.substitute_expr(i,e);return t[r]=new F(s),new n(t,this.is_heading)}}return null}}],[{key:"from_string",value:function(e){return new n([new V(e)])}},{key:"from_expr",value:function(e){return new n([new F(e)])}},{key:"from_string_with_placeholders",value:function(e){for(var t=e.split("[]"),r=[],i=0;i<t.length;i++)r.push(new V(t[i])),i<t.length-1&&r.push(new F(new T));return new n(r)}},{key:"concatenate_items",value:function(e,t,r){"expr"===e.item_type()&&(e=n.from_expr(e.expr)),"expr"===t.item_type()&&(t=n.from_expr(t.expr));for(var i=e.elements.concat(r?[new G(r)]:[],t.elements),s=[i[0]],a=1;a<i.length;a++){var o=s.length-1,c=s[o];c.is_text()&&i[a].is_text()&&c.is_bold===i[a].is_bold?s[o]=new V(c.text+i[a].text,i[a].is_bold):c.is_raw()&&c.is_explicit_space()&&i[a].is_text()?s[o]=new V(" "+i[a].text,i[a].is_bold):c.is_text()&&i[a].is_raw()&&i[a].is_explicit_space()?s[o]=new V(c.text+" ",c.is_bold):s.push(i[a])}return new n(s,e.is_heading||t.is_heading)}}]),n}(R),K=function(){function e(t){Object(u.a)(this,e),this.items=t}return Object(l.a)(e,[{key:"depth",value:function(){return this.items.length}},{key:"check",value:function(e){return this.depth()>=e}},{key:"check_exprs",value:function(e){if(!this.check(e))return!1;for(var t=0;t<e;t++)if("expr"!==this.items[this.items.length-1-t].item_type())return!1;return!0}},{key:"peek",value:function(e){return this.check(1)||this.underflow(),this.items[this.items.length-e]}},{key:"pop",value:function(e){return void 0===e&&(e=1),this.check(e)||this.underflow(),this._unchecked_pop(e)}},{key:"pop_exprs",value:function(e){this.check(e)||this.underflow(),this.check_exprs(e)||this.type_error();var t=this._unchecked_pop(e),n=Object(d.a)(t),r=n[0],i=n.slice(1);return[r].concat(Object(o.a)(i.map((function(e){return e.expr}))))}},{key:"pop_matrices",value:function(e){var t=this.pop_exprs(e),n=Object(d.a)(t),r=n[0],i=n.slice(1);if(i.every((function(e){return"array"===e.expr_type()&&e.is_matrix()})))return[r].concat(Object(o.a)(i));this.type_error()}},{key:"_unchecked_pop",value:function(t){return[new e(this.items.slice(0,-t))].concat(this.items.slice(-t))}},{key:"push_all",value:function(t){if(!t.every((function(e){return e instanceof R})))throw new Error("pushing invalid item onto stack");return new e(this.items.concat(t))}},{key:"push_all_exprs",value:function(e){return this.push_all(e.map((function(e){return new $(e)})))}},{key:"push",value:function(e){return this.push_all([e])}},{key:"push_expr",value:function(e){return this.push_all_exprs([e])}},{key:"clone_all_items",value:function(){return new e(this.items.map((function(e){return e.clone()})))}},{key:"underflow",value:function(){throw new Error("stack_underflow")}},{key:"type_error",value:function(){throw new Error("stack_type_error")}},{key:"to_json",value:function(){return{object_type:"stack",items:this.items.map((function(e){return e.to_json()}))}}}],[{key:"from_json",value:function(t){return new e(t.items.map((function(e){return R.from_json(e)})))}}]),e}(),X=function(){function e(t,n){Object(u.a)(this,e),this.items=t||[],this.selection_index=n}return Object(l.a)(e,[{key:"selected_item",value:function(){return this.selection_index>0?this.items[this.selection_index-1]:null}},{key:"insert_item",value:function(t){var n=this.selection_index;return new e(this.items.slice(0,n).concat([t],this.items.slice(n)),n+1)}},{key:"delete_selection",value:function(){var t=this.selection_index;return t>0?new e(this.items.slice(0,t-1).concat(this.items.slice(t)),t-1):null}},{key:"move_selection_by",value:function(t){var n=this.selection_index+t;return n<0&&(n=0),n>this.items.length&&(n=this.items.length),new e(this.items,n)}},{key:"shift_selection_by",value:function(e){var t=this.selected_item();return!t||this.selection_index+e<=0||this.selection_index+e>this.items.length?null:this.delete_selection().move_selection_by(e).insert_item(t)}},{key:"clone_all_items",value:function(){return new e(this.items.map((function(e){return e.clone()})),this.selection_index)}},{key:"to_json",value:function(){return{object_type:"document",items:this.items.map((function(e){return e.to_json()})),selection_index:this.selection_index}}},{key:"to_text",value:function(){return this.items.map((function(e){return e.to_text()})).join("\n\n")}}],[{key:"from_json",value:function(t){return new e(t.items.map((function(e){return R.from_json(e)})),t.selection_index||0)}}]),e}(),J=function(){function e(t,n){Object(u.a)(this,e),this.app_component=t,this.settings=n,this.mode="base",this.new_mode=null,this.new_document=null,this.files_changed=!1,this.file_saved=!1,this.notification_text=null,this.perform_undo_or_redo=null,this.prefix_argument=null,this.preserve_prefix_argument=!1,this.show_latex_source=!1,this.text_entry=null,this.text_entry_mode=null,this.custom_delimiters={}}return Object(l.a)(e,[{key:"handle_key",value:function(e,t){if("Shift"===t||"Alt"===t||"Control"===t)return[!1,e];var n=this.settings.popup_mode||this.mode,r=this.settings.current_keymap.lookup_binding(n,t);return r?(this.last_keypress=t,[!0,this.process_command(r,e)||e]):[!1,e]}},{key:"process_command",value:function(e,t){var n=e.split(";").map((function(e){return e.split(" ").map((function(e){return e.replaceAll("semicolon",";")}))}));return this.process_command_batch(n,t)}},{key:"process_command_batch",value:function(e,t){this.perform_undo_or_redo=null;for(var n=0;n<e.length;n++){var r=Object(d.a)(e[n]),i=r[0],s=r.slice(1),a=this["do_"+i];if(!a)return null;try{this.app_state=t,this.new_mode=null,this.new_document=null,this.files_changed=!1,this.file_saved=!1,this.preserve_prefix_argument=!1,this.notification_text=null;var c=a.bind(this).apply(void 0,[t.stack].concat(Object(o.a)(s))),u=new O(c||t.stack,this.new_document||t.document);u.is_dirty=t.is_dirty||!u.same_as(t),this.file_saved&&(u.is_dirty=!1),t=u,this.mode=this.new_mode||"base",this.preserve_prefix_argument||(this.prefix_argument=null)}catch(l){if("stack_underflow"===l.message||"stack_type_error"===l.message||"prefix_argument_required"===l.message)return this.error_flash_stack(),this.perform_undo_or_redo=null,this.mode="base",this.prefix_argument=null,null;throw l}finally{this.app_state=null,this.new_document=null}}return t}},{key:"switch_to_mode",value:function(e){this.new_mode=e}},{key:"error_flash_element",value:function(e){e.classList.remove("errorflash"),e.offsetWidth,e.classList.add("errorflash")}},{key:"error_flash_stack",value:function(){return 0===this.settings.layout.stack_split?this.error_flash_document():this.error_flash_element(document.getElementById("stack_panel"))}},{key:"error_flash_document",value:function(){return 100===this.settings.layout.stack_split?this.error_flash_stack():this.error_flash_element(document.getElementById("document_panel"))}},{key:"clear_all_flashes",value:function(){for(var e=["stack_panel","document_panel"],t=0;t<e.length;t++){document.getElementById(e[t]).classList.remove("errorflash")}}},{key:"notify",value:function(e){this.notification_text=e}},{key:"_build_subscript_superscript",value:function(e,t,n){return"subscriptsuperscript"===e.expr_type()&&(null===e.subscript_expr&&!n||null===e.superscript_expr&&n)?new P(e.base_expr,n?e.subscript_expr:t,n?t:e.superscript_expr):(e=U.autoparenthesize(e),new P(e,n?null:t,n?t:null))}},{key:"make_subscript_superscript",value:function(e,t){var n=e.pop_exprs(2),r=Object(c.a)(n,3),i=r[0],s=r[1],a=r[2],o=this._build_subscript_superscript(s,a,t);return i.push_expr(o)}},{key:"do_subscript",value:function(e){return this.make_subscript_superscript(e,!1)}},{key:"do_superscript",value:function(e){return this.make_subscript_superscript(e,!0)}},{key:"do_prime",value:function(e){var t=e.pop_exprs(1),n=Object(c.a)(t,2),r=n[0],i=n[1],s=new N("prime",[]);if("subscriptsuperscript"===i.expr_type()&&i.superscript_expr){var a,o=i.superscript_expr,u=function(e){return"command"===e.expr_type()&&0===e.operand_count()&&"prime"===e.command_name};if(a=u(o)?new L([o,s]):"sequence"===o.expr_type()&&o.exprs.every(u)?new L(o.exprs.concat([s])):null){var l=new P(i.base_expr,i.subscript_expr,a);return r.push_expr(l)}}var p=this._build_subscript_superscript(i,s,!0);return r.push_expr(p)}},{key:"do_mode",value:function(e,t){this.switch_to_mode(t)}},{key:"do_undo",value:function(){this.perform_undo_or_redo="undo"}},{key:"do_redo",value:function(){this.perform_undo_or_redo="redo"}},{key:"do_prefix_argument",value:function(){var e=this.last_keypress;this.perform_undo_or_redo="suppress",this.switch_to_mode(this.mode),this.preserve_prefix_argument=!0;var t=null;if(/^[0-9]$/.test(e)){var n=parseInt(e);null!==this.prefix_argument&&this.prefix_argument>0?t=10*this.prefix_argument+n:n>0&&(t=n)}else"*"===e&&(t=-1);this.prefix_argument=t}},{key:"_get_prefix_argument",value:function(e,t){return null===this.prefix_argument?e:this.prefix_argument<0?t:this.prefix_argument}},{key:"_require_prefix_argument",value:function(){if(null===this.prefix_argument||this.prefix_argument<=0)throw new Error("prefix_argument_required");return this.prefix_argument}},{key:"do_dup",value:function(e){var t=this._get_prefix_argument(1,e.depth()),n=e.pop(t),r=Object(d.a)(n),i=r[0],s=r.slice(1),a=s.map((function(e){return e.clone()}));return i.push_all(s.concat(a))}},{key:"do_pop",value:function(e){var t=this._get_prefix_argument(1,e.depth()),n=e.pop(t),r=Object(d.a)(n),i=r[0];r.slice(1);return i}},{key:"do_nip",value:function(e){var t=this._get_prefix_argument(2,e.depth()),n=e.pop(t),r=Object(d.a)(n),i=r[0],s=r.slice(1);return i.push_all(s.slice(1))}},{key:"do_swap",value:function(e){var t=this._get_prefix_argument(2,e.depth()),n=e.pop(t),r=Object(d.a)(n),i=r[0],s=r.slice(1);return s.reverse(),i.push_all(s)}},{key:"do_tuck",value:function(e){var t=this._get_prefix_argument(2,e.depth()),n=e.pop(t),r=Object(d.a)(n),i=r[0],s=r.slice(1),a=s[s.length-1];return i.push_all([a.clone()].concat(s))}},{key:"do_over",value:function(e){var t=this._get_prefix_argument(2,e.depth()),n=e.pop(t),r=Object(d.a)(n),i=r[0],s=r.slice(1);return i.push_all(s.concat([s[0].clone()]))}},{key:"do_rot",value:function(e){var t=this._get_prefix_argument(3,e.depth()),n=e.pop(t),r=Object(d.a)(n),i=r[0],s=r.slice(1),a=s.slice(1).concat([s[0]]);return i.push_all(a)}},{key:"do_unrot",value:function(e){var t=this._get_prefix_argument(3,e.depth()),n=e.pop(t),r=Object(d.a)(n),i=r[0],s=r.slice(1),a=s.slice(-1).concat(s.slice(0,-1));return i.push_all(a)}},{key:"do_change_document_selection",value:function(e,t){var n=parseInt(t);this.new_document=this.app_state.document.move_selection_by(n)}},{key:"do_shift_document_selection",value:function(e,t){var n=parseInt(t),r=this.app_state.document.shift_selection_by(n);r?this.new_document=r:this.error_flash_document()}},{key:"do_save_file",value:function(e){var t=this,n=this.app_component.state.file_manager_state.current_filename;if(!n)return this.do_save_file_as(e);this.app_component.state.document_storage.save_state(this.app_state,n,(function(){t.notify("Saved: "+n),t.settings.last_opened_filename=n,t.settings.save(),t.perform_undo_or_redo="clear",t.app_component.request_file_list()}),(function(){return t.notify("Error saving:"+n)})),this.file_saved=!0}},{key:"do_save_file_as",value:function(e){var t=this,n=window.prompt("Enter the filename to save as",this.settings.current_filename);if(n){var r=this.app_component.state.document_storage;n=r.sanitize_filename(n),r.save_state(this.app_state,n,(function(){t.notify("Saved as: "+n);var e=t.app_component.state.file_manager_state;e.selected_filename=e.current_filename=n,t.settings.last_opened_filename=n,t.settings.save(),t.perform_undo_or_redo="clear",t.app_component.request_file_list()}),(function(){return t.notify("Error saving: "+n)})),this.file_saved=!0}}},{key:"do_load_selected_file",value:function(e){var t=this.app_component.state.file_manager_state.selected_filename;return t?this.app_state.is_dirty&&window.confirm("The current document has been modified.  Save it now?")?this.do_save_file(e):void this.app_component.start_loading_filename(t):this.error_flash_document()}},{key:"do_start_new_file",value:function(e){var t=this.app_component.state.file_manager_state,n=this.app_component.state.document_storage,r=t.generate_unused_filename(t.current_filename||"untitled");if(r=window.prompt("Enter a filename for the new document",r)){if(r=n.sanitize_filename(r||"")){t.current_filename&&n.save_state(this.app_state,t.current_filename);var i=new O;return this.new_document=i.document,t.selected_filename=t.current_filename=r,this.settings.last_opened_filename=r,this.settings.save(),this.perform_undo_or_redo="clear",this.notify("Started new file: "+r),this.files_changed=!0,this.file_saved=!0,this.do_toggle_popup(i.stack,"files"),i.stack}alert("Invalid filename (must only contain letters, numbers and underscores)")}}},{key:"do_select_adjacent_file",value:function(e,t){var n=parseInt(t),r=this.app_component.state.file_manager_state,i=r.find_adjacent_filename(r.selected_filename,n);i&&(r.selected_filename=i,this.files_changed=!0)}},{key:"do_delete_selected_file",value:function(e){var t=this,n=this.app_component.state.file_manager_state,r=this.app_component.state.document_storage,i=n.selected_filename;if(!i)return this.error_flash_document();window.confirm('Really delete "'+i+'"?')&&r.delete_state(i,(function(){t.notify("Deleted: "+i);var e=n.find_adjacent_filename(i,1);n.selected_filename=e,t.settings.last_opened_filename=e,t.settings.save(),t.app_component.request_file_list()}),(function(){return t.notify("Error deleting: "+i)}))}},{key:"do_pop_to_document",value:function(e,t){for(var n=this._get_prefix_argument(1,e.depth()),r=e.pop(n),i=Object(d.a)(r),s=i[0],a=i.slice(1),o=this.app_state.document,c=0;c<a.length;c++)o=o.insert_item(a[c].clone());return this.new_document=o,t?s.push_all(a):s}},{key:"do_extract_from_document",value:function(e,t){var n=this._get_prefix_argument(1,-1);if(n<=0)return e;var r=this.app_state.document;if(r.selection_index<n)return this.error_flash_document();for(var i=[],s=0;s<n;s++){var a=r.selected_item();r=r.delete_selection(),i.push(a.clone())}return i.reverse(),t||(this.new_document=r),e.push_all(i)}},{key:"do_insert_separator",value:function(e,t){return e.push(new M(t))}},{key:"do_insert",value:function(e,t){return(t=t||"").startsWith("\\")?e.push_expr(new N(t.slice(1))):e.push_expr(new I(t))}},{key:"do_self_insert",value:function(e){return this.do_insert(e,this.last_keypress)}},{key:"do_insert_defer",value:function(e){return e.push_expr(new T)}},{key:"do_to_case",value:function(e,t){var n,r=e.pop_exprs(1),i=Object(c.a)(r,2),s=i[0],a=i[1];return n="text"===a.expr_type()?new I(function(e){switch(t){case"uppercase":return e.toUpperCase();case"lowercase":return e.toLowerCase();default:return e}}(a.text)):a,s.push_expr(n)}},{key:"do_operator",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"1",r=parseInt(n),i=e.pop_exprs(r),s=Object(d.a)(i),a=s[0],o=s.slice(1),c=new N(t,o);return a.push_expr(c)}},{key:"do_named_function",value:function(e,t,n){var r,i=e.pop_exprs(1),s=Object(c.a)(i,2),a=s[0],o=s[1],u=t;return void 0!==n&&(n.length>1&&(n="{"+n+"}"),t=t+"^"+n),o=U.autoparenthesize(o),r="sech"===u||"csch"===u?new N("operatorname",[new I(t),o]):new N(t,[o]),a.push_expr(r)}},{key:"do_apply_hat",value:function(e,t){var n=e.pop_exprs(1),r=Object(c.a)(n,2),i=r[0],s=r[1];if("text"!==s.expr_type()||"i"!==s.text&&"j"!==s.text){if("command"===s.expr_type()&&1===s.operand_count()&&("boldsymbol"===s.command_name||"mathbf"===s.command_name)){var a=s.operand_exprs[0];"text"!==a.expr_type()||"i"!==a.text&&"j"!==a.text||(s=new N(s.command_name,[new N("i"===a.text?"imath":"jmath")]))}}else s=new N("i"===s.text?"imath":"jmath");var o=new N(t,[s]);return i.push_expr(o)}},{key:"do_color",value:function(e,t){var n=e.pop_exprs(1),r=Object(c.a)(n,2),i=r[0],s=r[1];"command"===s.expr_type()&&"textcolor"===s.command_name&&2===s.operand_count()&&(s=s.operand_exprs[1]);var a=new N("textcolor",[new I(t),s]);return i.push_expr(a)}},{key:"do_make_bold",value:function(e){var t=e.pop(1),n=Object(c.a)(t,2),r=n[0],i=n[1];return"expr"===i.item_type()?r.push_expr(i.expr.as_bold()):"text"===i.item_type()?r.push(i.as_bold()):void r.type_error()}},{key:"do_custom_delimiter",value:function(e,t){return this.switch_to_mode("custom_delimiters"),t?this.custom_delimiters.left?this.custom_delimiters.right?(this.custom_delimiters.middle=t,this._finish_custom_delimiters(e)):(this.custom_delimiters.right=t,null===this.prefix_argument||this.prefix_argument<=1?this._finish_custom_delimiters(e):void(this.preserve_prefix_argument=!0)):(this.custom_delimiters.left=t,void(this.preserve_prefix_argument=!0)):(this.custom_delimiters={},void(this.preserve_prefix_argument=!0))}},{key:"_finish_custom_delimiters",value:function(e){this.switch_to_mode("base");var t=this.custom_delimiters,n=this.prefix_argument||1;n<1&&(n=1);var r=e.pop_exprs(n),i=Object(d.a)(r),s=i[0],a=i.slice(1),o=new U(t.left,t.right,t.middle,a);return this.custom_delimiters={},s.push_expr(o)}},{key:"do_infix",value:function(e,t){var n,r=e.pop(2),i=Object(c.a)(r,3),s=i[0],a=i[1],o=i[2],u=a.item_type(),l=o.item_type();if("expr"===u&&"expr"===l)return n=t.startsWith("\\")?new N(t.slice(1)):new I(t),s.push_expr(new D(n,a.expr,o.expr));if("expr"!==u&&"text"!==u||"expr"!==l&&"text"!==l)return e.type_error();var p=H.concatenate_items(a,o,t);return s.push(p)}},{key:"do_conjunction",value:function(e,t){var n=e.pop(2),r=Object(c.a)(n,3),i=r[0],s=r[1],a=r[2],o=s.item_type(),u=a.item_type();if("expr"===o&&"expr"===u){var l=new L([new N("quad"),new N("text",[new I(t.replaceAll("_"," "))]),new N("quad")]);return i.push_expr(new D(l,s.expr,a.expr))}if("expr"!==o&&"text"!==o||"expr"!==u&&"text"!==u)return e.type_error();var p=H.from_string(" "+t+" "),_=H.concatenate_items(s,H.concatenate_items(p,a));return i.push(_)}},{key:"do_prefix",value:function(e,t){var n,r=e.pop_exprs(1),i=Object(c.a)(r,2),s=i[0],a=i[1];return n=t.startsWith("\\")?new N(t.slice(1)):new I(t),s.push_expr(new A(a,n))}},{key:"do_split_infix",value:function(e){var t=e.pop_exprs(1),n=Object(c.a)(t,2),r=n[0],i=n[1];if("infix"===i.expr_type()){var s=i.split,a=null;a="after"===s?"before":"before"===s?null:"after";var o=i.with_split_mode(a);return r.push_expr(o)}this.error_flash_stack()}},{key:"do_stackrel",value:function(e,t){var n=e.pop_exprs(2),r=Object(c.a)(n,3),i=r[0],s=r[1],a=r[2];if("infix"===s.expr_type()){var o=new N(t,[a,s.operator_expr]),u=new D(o,s.left_expr,s.right_expr);return i.push_expr(u)}this.error_flash_stack()}},{key:"do_cancel",value:function(){}},{key:"do_concat",value:function(e){var t=e.pop(2),n=Object(c.a)(t,3),r=n[0],i=n[1],s=n[2],a=i.item_type(),o=s.item_type();if("expr"===a&&"expr"===o){var u=i.expr,l=s.expr,p=q.combine_pair(u,l);return r.push_expr(p)}if("expr"!==a&&"text"!==a||"expr"!==o&&"text"!==o)return e.type_error();var _=H.concatenate_items(i,s);return r.push(_)}},{key:"do_substitute_defer",value:function(e){var t=e.pop_exprs(1),n=Object(c.a)(t,2),r=n[0],i=n[1],s=r.pop(1),a=Object(c.a)(s,2),o=a[0],u=a[1];if("expr"===u.item_type()){var l=u.expr,p=l.find_defer();if(p){var _=l.substitute_expr(p,i);return o.push_expr(_)}}else if("text"===u.item_type()){var h=u.try_substitute_defer(i);if(h)return o.push(h)}return e.type_error()}},{key:"do_extract_infix_side",value:function(e,t){var n=e.pop_exprs(1),r=Object(c.a)(n,2),i=(r[0],r[1]);if("infix"!==i.expr_type())return e.type_error();var s="right"===t?i.right_expr:i.left_expr;return e.push_expr(s)}},{key:"do_start_text_entry",value:function(e,t){return this.text_entry="",this.text_entry_mode=t,this.switch_to_mode(t),this.perform_undo_or_redo="suppress",e}},{key:"do_cancel_text_entry",value:function(e){return this.cancel_text_entry(),this.perform_undo_or_redo="suppress",e}},{key:"cancel_text_entry",value:function(){this.text_entry=null,this.text_entry_mode=null}},{key:"do_append_text_entry",value:function(e){var t=this.last_keypress;if(this.perform_undo_or_redo="suppress",this.switch_to_mode(this.mode),1===t.length){if("latex_entry"===this.text_entry_mode&&!/^[a-zA-Z]$/.test(t))return this.error_flash_stack();this.text_entry=(this.text_entry||"")+t}return e}},{key:"do_backspace_text_entry",value:function(e,t){var n=this.text_entry||"";return n.length>0?(this.text_entry=n.slice(0,-1),this.switch_to_mode(this.mode)):t?(this.text_entry_mode=t,this.switch_to_mode(t)):this.cancel_text_entry(),this.perform_undo_or_redo="suppress",e}},{key:"do_finish_text_entry",value:function(e,t){if(null===this.text_entry)return e;if(0===this.text_entry.length)return this.cancel_text_entry(),e;if("text"===t||"heading"===t){var n=H.from_string_with_placeholders(this.text_entry);return"heading"===t&&(n.is_heading=!0),this.cancel_text_entry(),e.push(n)}var r;return r="roman_math"===t?new N("mathrm",[new I(this._latex_escape(this.text_entry))]):"latex"===t?new N(this.text_entry):new I(this._latex_escape(this.text_entry)),this.cancel_text_entry(),e.push_expr(r)}},{key:"_latex_escape",value:function(e){var t={" ":"\\,",_:"\\_","^":"\\wedge ","%":"\\%","'":"\\rq ","`":"\\lq ",$:"\\$","&":"\\&","#":"\\#","}":"\\}","{":"\\{","~":"\\sim ","\\":"\\backslash "};return e.replaceAll(/[ _^%'`$&#}{~\\]/g,(function(e){return t[e]}))}},{key:"do_toggle_is_heading",value:function(e){var t=e.pop(1),n=Object(c.a)(t,2),r=n[0],i=n[1];if("expr"===i.item_type()&&(i=H.from_expr(i.expr)),"text"===i.item_type())return(i=i.clone()).is_heading=!i.is_heading,r.push(i);this.error_flash_stack()}},{key:"do_toggle_show_latex_source",value:function(e){this.show_latex_source=!this.show_latex_source,this.perform_undo_or_redo="suppress"}},{key:"do_delimiters",value:function(e,t,n,r,i){var s=void 0===i?1:parseInt(i),a=e.pop_exprs(s),o=Object(d.a)(a),c=o[0],u=o.slice(1),l=new U(t,n,r,u);return c.push_expr(l)}},{key:"do_parenthesize",value:function(e){var t=e.pop_exprs(1),n=Object(c.a)(t,2),r=n[0],i=n[1];return"delimiter"===i.expr_type()&&"."===i.left_type&&"."===i.right_type&&i.inner_exprs.length>1?i=new U("(",")",i.middle_type,i.inner_exprs):"delimiter"!==i.expr_type()&&(i=U.parenthesize(i)),r.push_expr(i)}},{key:"do_autoparenthesize",value:function(e,t){var n=void 0===t?1:parseInt(t),r=e.pop(n),i=Object(d.a)(r),s=i[0],a=i.slice(1);return a.every((function(e){return"expr"===e.item_type()}))?s.push_all_exprs(a.map((function(e){return U.autoparenthesize(e.expr)}))):e}},{key:"do_apply_operator",value:function(e,t){var n=parseInt(t),r=e.pop_exprs(n+1),i=Object(d.a)(r),s=i[0],a=i.slice(1),o=a[a.length-1],c=a.slice(0,n);if("command"===o.expr_type()&&0===o.operand_count())return s.push_expr(new N(o.command_name,c));this.error_flash_stack()}},{key:"do_apply_infix",value:function(e){var t=e.pop_exprs(3),n=Object(c.a)(t,4),r=n[0],i=n[1],s=n[2],a=n[3],o=new D(a,i,s);return r.push_expr(o)}},{key:"do_toggle_popup",value:function(e,t,n){if("help"===this.settings.popup_mode){var r=document.getElementById("popup_panel");r&&r.scrollTop&&(this.settings.help_scroll_top=r.scrollTop)}this.settings.popup_mode=this.settings.popup_mode===t?null:t,"help"===this.settings.popup_mode&&n&&(this.settings.help_scroll_top=n),this.settings.save(),this.app_component.apply_layout_to_dom()}},{key:"do_config",value:function(e,t,n){var r=this.settings,i=r.layout,s=!1;switch(t){case"zoom_factor":switch(n){case"0":i.zoom_factor=0;break;case"+":i.zoom_factor++;break;case"-":i.zoom_factor--}break;case"math_align":switch(n){case"toggle_document":i.document_rightalign_math=!i.document_rightalign_math;break;case"toggle_stack":i.stack_rightalign_math=!i.stack_rightalign_math}break;case"toggle_inline_math":i.inline_math=!i.inline_math,s=!0;break;case"stack_side":i.stack_side=n;break;case"stack_split":i.stack_split=parseInt(n);break;case"theme":r.selected_theme=n;break;case"reset_layout":r.layout=r.default_layout(),s=!0}if(r.save(),this.app_component.apply_layout_to_dom(),this.clear_all_flashes(),s)return this.new_document=this.app_state.document.clone_all_items(),e.clone_all_items()}},{key:"do_build_matrix_row",value:function(e,t,n){var r=n?parseInt(n):this._require_prefix_argument(),i=e.pop_exprs(r),s=Object(d.a)(i),a=s[0],o=s.slice(1),c=new B(t||"bmatrix",1,r,[o]);return a.push_expr(c)}},{key:"do_stack_matrices",value:function(e){var t=e.pop_matrices(2),n=Object(c.a)(t,3),r=n[0],i=n[1],s=n[2];i.column_count!==s.column_count&&r.type_error();var a=new B(s.array_type,i.row_count+s.row_count,i.column_count,i.element_exprs.concat(s.element_exprs));return r.push_expr(a)}},{key:"do_split_matrix",value:function(e){var t=e.pop_matrices(1),n=Object(c.a)(t,2),r=n[0],i=n[1];return r.push_all_exprs(i.split_rows())}},{key:"do_dissolve_matrix",value:function(e){var t,n=e.pop_matrices(1),r=Object(c.a)(n,2),i=r[0],s=r[1],a=(t=[]).concat.apply(t,Object(o.a)(s.element_exprs));return i.push_all_exprs(a)}},{key:"do_insert_matrix_ellipses",value:function(e){var t=e.pop_matrices(1),n=Object(c.a)(t,2),r=n[0],i=n[1];return r.push_expr(i.with_ellipses())}},{key:"do_matrix_transpose",value:function(e){var t=e.pop_matrices(1),n=Object(c.a)(t,2),r=n[0],i=n[1];return r.push_expr(i.transposed())}},{key:"do_build_align",value:function(e,t){var n,r=this._require_prefix_argument(),i=e.pop_exprs(r),s=Object(d.a)(i),a=s[0],o=s.slice(1);switch(t){case"gathered":case"gather":n="none";break;case"cases":case"rcases":n="colon";break;case"cases_if":n="colon_if",t="cases";break;case"rcases_if":n="colon_if",t="rcases";break;default:n="infix"}var c=B.split_elements(o,n),u=new B(t,c.length,c[0].length,c);return a.push_expr(u)}},{key:"do_build_list",value:function(e,t,n){for(var r=this._require_prefix_argument(),i=e.pop_exprs(r),s=Object(d.a)(i),a=s[0],o=s.slice(1),c=o[0],u=1;u<r;u++){var l=n&&u===r-1?n:t;c=q.combine_pair(c,new I(l)),c=q.combine_pair(c,o[u])}return a.push_expr(c)}},{key:"do_build_infix_list",value:function(e,t,n){var r=this._require_prefix_argument(),i=e.pop_exprs(r),s=Object(d.a)(i),a=s[0],o=s.slice(1),c=new I(t),u=o[r-1];n&&r>1&&(u=new D(c,new I(n),u));for(var l=r-2;l>=0;l--)u=new D(c,o[l],u);return a.push_expr(u)}},{key:"do_build_substack",value:function(e){var t=this._require_prefix_argument(),n=e.pop_exprs(t),r=Object(d.a)(n),i=r[0],s=r.slice(1).map((function(e){return e.to_latex()})).join("\\\\"),a=new N("substack",[new I(s)]);return i.push_expr(a)}},{key:"do_apply_tag",value:function(e){var t,n=e.pop(2),r=Object(c.a)(n,3),i=r[0],s=r[1],a=r[2];return"expr"!==s.item_type()||"expr"!==a.item_type()?e.type_error():(t=a.expr,i.push(new $(s.expr,t)))}},{key:"do_copy_to_clipboard",value:function(e){var t=e.pop(1),n=Object(c.a)(t,2),r=n[0],i=n[1],s=this._get_prefix_argument(1,"*");return this.app_component.state.clipboard_items[s]=i,1===s?this.notify("Copied to clipboard"):this.notify("Copied to clipboard slot "+s),r.push(i)}},{key:"do_paste_from_clipboard",value:function(e){var t=this._get_prefix_argument(1,"*"),n=this.app_component.state.clipboard_items[t];if(n)return e.push(n.clone());this.error_flash_stack()}},{key:"do_recenter_document",value:function(e,t){var n=parseInt(t);this.perform_undo_or_redo="suppress";var r=document.getElementById("document_container");if(r){var i=r.getElementsByClassName("selected");if(0!==i.length){var s=i[0],a=s.offsetTop,o=s.offsetTop+s.offsetHeight-r.clientHeight,c=n/100,u=Math.round(a*(1-c)+o*c);r.scrollTop=u}}}},{key:"do_scroll",value:function(e,t,n,r){var i=document.getElementById(t);if(i){var s=parseInt(r||"50")/100;"horizontal"===n?i.scrollLeft+=Math.round(i.clientWidth*s):i.scrollTop+=Math.round(i.clientHeight*s)}}},{key:"do_export_document_as_text",value:function(e){var t=this.app_state.document.to_text();navigator.clipboard.writeText(t),this.notify("Copied document to clipboard")}},{key:"do_export_stack_items_as_text",value:function(e){var t=this._get_prefix_argument(1,e.depth()),n=e.pop(t),r=Object(d.a)(n),i=(r[0],r.slice(1).map((function(e){return e.to_text()})).join("\n\n"));navigator.clipboard.writeText(i),this.notify("Copied "+t+" item"+(1===t?"":"s")+" to clipboard")}}]),e}(),Z=i.a.createElement,Q=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(e){var r;Object(u.a)(this,n),r=t.call(this,e);var i=w.load_from_local_storage();return r.state={app_state:new O,settings:i,file_manager_state:new S,import_export_state:new E,document_storage:new C,input_context:new J(Object(p.a)(r),i),undo_stack:new z,clipboard_items:{}},r.state.undo_stack.clear(r.state.app_state),r.state.import_export_state.document_storage=r.state.document_storage,r.state.import_export_state.onstatechange=function(){return r.import_export_state_changed()},r.handleKeyDown=r.handleKeyDown.bind(Object(p.a)(r)),r.handleBeforeUnload=r.handleBeforeUnload.bind(Object(p.a)(r)),r.handleVisibilityChange=r.handleVisibilityChange.bind(Object(p.a)(r)),r.state.document_storage.open_database(r.on_open_database.bind(Object(p.a)(r))),r}return Object(l.a)(n,[{key:"on_open_database",value:function(){if(this.request_file_list(),this.state.settings.last_opened_filename)this.start_loading_filename(this.state.settings.last_opened_filename);else{var e=this.state.file_manager_state,t=this.state.settings,n="untitled";e.current_filename=e.selected_filename=n,t.last_opened_filename=n,t.save()}}},{key:"file_manager_state_changed",value:function(){this.setState({file_manager_state:this.state.file_manager_state})}},{key:"import_export_state_changed",value:function(){var e=this.state.import_export_state;this.setState({import_export_state:e}),e.file_list_needs_update&&(e.file_list_needs_update=!1,this.request_file_list())}},{key:"request_file_list",value:function(){this.state.document_storage.fetch_file_list(this.file_list_request_finished.bind(this),this.file_list_request_error.bind(this))}},{key:"file_list_request_finished",value:function(e){var t=this.state.file_manager_state;t.unavailable=!1,t.file_list=e,t.sort_file_list("filename",!0),this.setState({file_manager_state:t})}},{key:"file_list_request_error",value:function(){var e=this.state.file_manager_state;e.unavailable=!0,this.setState({file_manager_state:e})}},{key:"start_loading_filename",value:function(e){this.state.document_storage.load_state(e,this.file_load_finished.bind(this),this.file_load_error.bind(this))}},{key:"file_load_finished",value:function(e,t){var n=this.state.file_manager_state,r=this.state.settings;n.selected_filename=n.current_filename=e,r.last_opened_filename=e,r.save(),this.setState({app_state:t,file_manager_state:n}),this.state.undo_stack.clear(t),this.state.input_context.notify("Loaded: "+e)}},{key:"file_load_error",value:function(e,t){}},{key:"componentDidMount",value:function(){this.apply_layout_to_dom(),window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("beforeunload",this.handleBeforeUnload),window.addEventListener("visibilitychange",this.handleVisibilityChange),this.request_file_list()}},{key:"apply_layout_to_dom",value:function(){this.stack_panel_ref.current&&this.document_panel_ref.current&&this.popup_panel_ref.current&&this.state.settings.apply_layout_to_dom(this.stack_panel_ref.current,this.document_panel_ref.current,this.popup_panel_ref.current)}},{key:"componentDidUpdate",value:function(){var e=this.state.file_manager_state.current_filename,t="rpnlatex",n=e?"rpnlatex - "+e:t;n!==document.title&&(document.title=n)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("beforeunload",this.handleBeforeUnload),window.removeEventListener("visibilitychange",this.handleVisibilityChange)}},{key:"render",value:function(){var e=this.state.app_state;return this.stack_panel_ref=i.a.createRef(),this.document_panel_ref=i.a.createRef(),this.popup_panel_ref=i.a.createRef(),Z("div",{id:"panel_layout",className:"theme_"+this.state.settings.selected_theme},Z("div",{className:"panel stack_panel",id:"stack_panel",ref:this.stack_panel_ref},Z(ee,{settings:this.state.settings,stack:e.stack,input_context:this.state.input_context}),Z(Y,{app_state:e,input_context:this.state.input_context})),Z("div",{className:"panel document_panel",id:"document_panel",ref:this.document_panel_ref},Z("div",{id:"document_container"},Z(te,{settings:this.state.settings,document:e.document,filename:this.state.file_manager_state.current_filename,is_dirty:e.is_dirty}))),Z(ae,{settings:this.state.settings,popup_panel_ref:this.popup_panel_ref,import_export_state:this.state.import_export_state,document_storage:this.state.document_storage,file_manager_state:this.state.file_manager_state}))}},{key:"handleKeyDown",value:function(e){if(!e.altKey&&!e.metaKey){var t=this._keyname_from_event(e);if("Meta"!==t&&"Ctrl+Control"!==t){var n=this.state.app_state,r=this.state.input_context.handle_key(n,t),i=Object(c.a)(r,2),s=i[0],a=i[1];if(s){e.preventDefault();var o=this.manage_undo_state(a);o?a=o:this.state.input_context.error_flash_stack();var u={app_state:a};this.state.input_context.files_changed&&(this.request_file_list(),u.file_manager_state=this.state.file_manager_state),this.setState(u)}}}}},{key:"_keyname_from_event",value:function(e){var t=e.key;return(t.startsWith("Arrow")||"Enter"===t||"Backspace"===t)&&e.shiftKey&&(t="Shift+"+t),e.ctrlKey&&(t="Ctrl+"+t),t}},{key:"handleBeforeUnload",value:function(e){var t=this.state.file_manager_state.current_filename;return t&&this.state.document_storage.save_state(this.state.app_state,t),null}},{key:"handleVisibilityChange",value:function(e){this.setState({})}},{key:"manage_undo_state",value:function(e){var t=this.state.undo_stack;switch(this.state.input_context.perform_undo_or_redo){case"undo":return t.undo_state();case"redo":return t.redo_state();case"suppress":return e;case"clear":return t.clear(e),e;default:return t.push_state(e),e}}}]),n}(i.a.Component),Y=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props.input_context,t=void 0,n=e.notification_text,r=e.mode;if(null!==e.prefix_argument&&(r=[r,"(",e.prefix_argument<0?"*":e.prefix_argument.toString(),")"].join("")),n){var i=n.indexOf(":");t=i>=0?Z("span",{className:"notification"},Z("span",{},n.slice(0,i+1)),Z("span",{className:"highlighted"},n.slice(i+1))):Z("span",{className:"notification"},n)}else"base"!==r&&(t=Z("span",{className:"mode"},r.replaceAll("_"," ")));return Z("div",{className:"indicator"},t)}}]),n}(i.a.Component),ee=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this,t=this.props.input_context,n=this.props.stack.items.map((function(n,r){var s="stack"===t.mode&&(t.prefix_argument<0||e.props.stack.items.length-r<=t.prefix_argument);return t.show_latex_source&&r===e.props.stack.items.length-1?Z(se,{item:n,key:n.react_key(r)}):Z(ie,{item:n,selected:s,inline_math:e.props.settings.layout.inline_math,item_ref:i.a.createRef(),key:n.react_key(r)})}));if(null!==t.text_entry){var r=Z(ne,{text:t.text_entry,entry_type:t.text_entry_mode,key:"textentry"});n.push(r)}var s=["stack_items"];return this.props.settings.layout.stack_rightalign_math&&s.push("rightalign_math"),Z("div",{className:s.join(" ")},n)}}]),n}(i.a.Component),te=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this,t=this.props.document,n=t.items.map((function(n,r){var s=i.a.createRef(),a=t.selection_index===r+1;return a&&(e.selected_item_ref=s),Z(ie,{item:n,selected:a,inline_math:e.props.settings.layout.inline_math,item_ref:s,key:n.react_key(r)})}));n.push(Z("div",{className:"bottom_spacer",key:"bottom_spacer"}));var r=0===t.selection_index;r&&(this.selected_item_ref=i.a.createRef());var s=Z("div",{className:"top_spacer"+(r?" selected":""),key:"top_spacer",ref:r?this.selected_item_ref:null}),a=["document_items"];return this.props.settings.layout.document_rightalign_math&&a.push("rightalign_math"),Z("div",{className:a.join(" ")},[s].concat(n))}},{key:"componentDidUpdate",value:function(){this.ensure_selection_visible()}},{key:"ensure_selection_visible",value:function(){if(this.selected_item_ref){var e=this.selected_item_ref.current;if(e){var t=document.getElementById("document_container"),n=e.offsetHeight/2;e.offsetTop<t.scrollTop&&(t.scrollTop=e.offsetTop-n),e.offsetTop+e.offsetHeight>t.scrollTop+t.offsetHeight&&(t.scrollTop=e.offsetTop+e.offsetHeight-t.offsetHeight+n)}}}}]),n}(i.a.Component),ne=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e="text_entry "+this.props.entry_type+"_mode";return Z("div",{className:e},this.props.text)}}]),n}(i.a.Component),re=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=!this.props.file_manager_state.unavailable;return this.file_input_ref=i.a.createRef(),Z("div",{className:"file_header",id:"files_panel"},Z("h2",{},"File Manager"),this.render_file_table(),this.render_shortcuts(),e&&Z("h2",{},"Export/Import"),e&&this.render_export_import_section())}},{key:"render_export_import_section",value:function(){var e=this.props.import_export_state,t=[];if(t.push(Z("p",{},"This section lets you download the internal browser document storage as a .zip file, or restore the internal storage from a previously downloaded export.")),t.push(Z("p",{},Z("strong",{},e.textual_state()))),"idle"===e.state&&t.push(Z("p",{},Z("a",{href:"#",onClick:this.start_exporting.bind(this)},"Prepare Export"))),e.download_available()){var n=e.generate_download_filename();t.push(Z("p",{},Z("a",{href:e.download_url,download:n},"Download: "+n)))}return"idle"===e.state&&t.push(Z("p",{},Z("span",{},"Import Zip File: "),Z("input",{type:"file",ref:this.file_input_ref}),Z("input",{type:"button",value:"Upload",onClick:this.handle_file_upload.bind(this)}))),"idle"===e.state&&e.import_result_string&&t.push(Z("p",{},Z("span",{style:{fontWeight:"bold"}},"Import result: "),Z("span",{},e.import_result_string))),Z.apply(void 0,["div",{}].concat(t))}},{key:"render_file_table",value:function(){var e=this,t=this.props.file_manager_state;return t.unavailable?Z("p",{},"IndexedDB support unavailable in your browser.  You will be unable to save or load documents.  Note that Firefox disables IndexedDB when in Private Browsing mode."):t.file_list&&t.file_list.length>0?Z("div",{},Z("table",{className:"file_table"},Z("thead",{},Z("tr",{},Z("th",{className:"filename"},"Filename"),Z("th",{className:"filesize",colSpan:"2"},"Size"),Z("th",{className:"timestamp",colSpan:"2"},"Last Modified"))),Z("tbody",{},t.file_list.map((function(t,n){return e._render_file_list_row(t,n)}))))):t.file_list?Z("p",{},"No files created yet."):Z("p",{},"Fetching file list...")}},{key:"_render_file_list_row",value:function(e,t){var n=this.props.file_manager_state,r=[];e.filename===n.selected_filename&&r.push("selected_file"),e.filename===n.current_filename&&r.push("current_file");var i=e.document_item_count+e.stack_item_count;return Z("tr",{className:r.join(" "),key:"file_"+e.filename},Z("td",{className:"filename"},e.filename),Z("td",{className:"filesize"},Math.floor((e.filesize+1023)/1024)+" kb"),Z("td",{className:"filesize"},i+" object"+(1===i?"":"s")),Z("td",{className:"timestamp"},e.timestamp.toLocaleDateString()),Z("td",{className:"timestamp"},e.timestamp.toLocaleTimeString()))}},{key:"render_shortcuts",value:function(){var e=this.props.file_manager_state.current_filename,t=[["Escape","Close file manager"],["Arrows","Select next/previous file"],["Enter","Open selected file"],["d","Delete selected file"],["n","Start a new empty file"],["s","Save current file"+(e?" ("+e+")":"")],["S","Save as..."]].map((function(e){var t=Object(c.a)(e,2),n=t[0],r=t[1];return Z("li",{},Z("span",{className:"keybinding"},n),Z("span",{}," "+r))}));return Z.apply(void 0,["ul",{className:"keybindings"}].concat(Object(o.a)(t)))}},{key:"handle_file_upload",value:function(e){var t=this.file_input_ref.current;if(t){var n=t.files;1===n.length?this.start_importing(n[0]):n.length>1?alert("Please select a single .zip file to import."):alert("Please select a .zip file to import.")}}},{key:"start_importing",value:function(e){var t=this.props.import_export_state;"idle"===t.state&&t.start_importing(e)}},{key:"start_exporting",value:function(){var e=this.props.import_export_state;"idle"===e.state&&e.start_exporting()}}]),n}(i.a.Component),ie=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props.item,t=this.props.item_ref,n=this.props.selected?"selected ":"";switch("text"===e.item_type()&&e.is_heading&&(n="heading_style "+n),e.item_type()){case"expr":return e.tag_expr?(this.tag_ref=i.a.createRef(),Z("div",{className:"expr_item"},Z("div",{className:"tag_expr",ref:this.tag_ref},""),Z("div",{className:n+"latex_fragment",ref:t},""))):Z("div",{className:"expr_item"},Z("div",{className:n+"latex_fragment",ref:t},""));case"text":return Z("div",{className:"text_item"},Z("div",{className:n+"latex_fragment"},Z("div",{className:"latex_fragment_inner",ref:t},"")));case"separator":return Z("div",{className:n+"separator_item"},Z("hr"));default:return Z("div",{},"????")}}},{key:"componentDidMount",value:function(){var e=this.props.item,t=this.props.item_ref.current;t&&("expr"===e.item_type()?(this._render_with_katex(e.expr.to_latex(),t,!this.props.inline_math),e.tag_expr&&this.tag_ref.current&&this._render_with_katex(e.tag_expr.to_latex(),this.tag_ref.current,!1)):"text"===e.item_type()&&this._render_with_katex(e.to_latex(),t,!1))}},{key:"_render_with_katex",value:function(e,t,n){""!==e&&"\\,"!==e||(e="\\text{(blank)}");try{m.a.render(e,t,{throwOnError:!1,displayMode:n,fleqn:!0,trust:!0})}catch(i){var r=i.toString();t.innerHTML='<div style="color:red;">'+r+"</div>"}}}]),n}(i.a.Component),se=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props.item;return Z("div",{className:"latex_source_item"},Z("div",{className:"latex_source"},e.to_text()))}}]),n}(i.a.Component),ae=function(e){Object(_.a)(n,e);var t=Object(h.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){this.refs={help:i.a.createRef(),help_content:i.a.createRef()};var e=null;return"files"===this.props.settings.popup_mode&&(e=Z("div",{id:"files_container"},Z(re,{import_export_state:this.props.import_export_state,document_storage:this.props.document_storage,file_manager_state:this.props.file_manager_state}))),Z("div",{id:"popup_panel",ref:this.props.popup_panel_ref},e,Z("div",{id:"help_container",ref:this.refs.help},Z("div",{className:"help",ref:this.refs.help_content})))}},{key:"componentDidMount",value:function(){var e=document.getElementById("helptext"),t=this.refs.help_content.current;e&&(e.style.display="block",this._render_help_latex(e),e.parentNode.removeChild(e),t.appendChild(e))}},{key:"componentDidUpdate",value:function(){var e=this.props.settings.popup_mode;this.refs.help.current&&(this.refs.help.current.style.display="help"===e?"block":"none"),"help"===e&&void 0!==this.props.settings.help_scroll_top&&this.props.popup_panel_ref.current&&("string"===typeof this.props.settings.help_scroll_top?window.location.hash="#"+this.props.settings.help_scroll_top:this.props.popup_panel_ref.current.scrollTop=this.props.settings.help_scroll_top,this.props.settings.help_scroll_top=void 0)}},{key:"_render_help_latex",value:function(e){for(var t=e.getElementsByTagName("code"),n=0;n<t.length;n++){var r=t[n],i=r.textContent;i&&m.a.render(i,r,{throwOnError:!1,displayMode:!1,trust:!0})}}}]),n}(i.a.Component),oe=Q,ce=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ue(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var le=n(21);a.a.createRoot(document.getElementById("root")).render(Object(le.jsx)(oe,{})),function(e){if("serviceWorker"in navigator){if(new URL(".",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat(".","/service-worker.js");ce?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):ue(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):ue(t,e)}))}}()}},[[36,1,2]]]);
//# sourceMappingURL=main.7dd079dd.chunk.js.map